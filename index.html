<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DF ACADEMY ¬∑ Calculadora de Tama√±o de Posici√≥n</title>
  <meta name="description" content="Calculadora de tama√±o de posici√≥n para trading de Forex, Metales, √çndices, Criptomonedas y Commodities por DF ACADEMY." />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#040D51" />
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="DF Calc" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <script>tailwind={config:{theme:{extend:{colors:{brand:'#1a2654',brandDark:'#0f172a',accent:'#F7BE0C',accentDark:'#d4a00a'},fontFamily:{sans:['Outfit','sans-serif'],mono:['JetBrains Mono','monospace']}}}}}</script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{background:linear-gradient(180deg,#f8fafc 0%,#f1f5f9 50%,#e2e8f0 100%);font-family:'Outfit',sans-serif;min-height:100vh}
    .header-gradient{background:linear-gradient(135deg,#1a2654 0%,#0f172a 50%,#1a2654 100%)}
    .logo-glow{filter:drop-shadow(0 0 10px rgba(247,190,12,0.3))}
    .ticker-wrapper{background:linear-gradient(90deg,#0f172a 0%,#1a2654 50%,#0f172a 100%);border-top:1px solid rgba(247,190,12,0.2);border-bottom:1px solid rgba(247,190,12,0.2)}
    .result-card{transition:all 0.2s ease}
    .result-card:hover{transform:translateY(-2px);box-shadow:0 8px 25px -5px rgba(26,38,84,0.15)}
    select,input{font-family:'Outfit',sans-serif}
    .mono{font-family:'JetBrains Mono',monospace}
    .category-badge{font-size:10px;padding:2px 8px;border-radius:6px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
    .cat-forex{background:#dbeafe;color:#1e40af}
    .cat-metals{background:#fef3c7;color:#92400e}
    .cat-energy{background:#fee2e2;color:#991b1b}
    .cat-indices{background:#d1fae5;color:#065f46}
    .cat-crypto{background:#ede9fe;color:#5b21b6}
    optgroup{font-weight:700;color:#1a2654;background:#f8fafc}
    .gradient-border{background:linear-gradient(135deg,#1a2654,#F7BE0C);padding:2px;border-radius:16px}
    .gradient-border>div{background:white;border-radius:14px}
    .accuracy-badge{display:inline-flex;align-items:center;gap:4px;font-size:11px;padding:4px 10px;border-radius:8px;font-weight:600}
    .accuracy-high{background:#d1fae5;color:#065f46}
    .accuracy-low{background:#fee2e2;color:#991b1b}
    .info-box{background:linear-gradient(135deg,#eff6ff 0%,#dbeafe 100%);border:1px solid #bfdbfe}
    .price-box{background:linear-gradient(135deg,#fefce8 0%,#fef3c7 100%);border:2px solid #fde047}
    .collapsible-header{cursor:pointer;user-select:none}
    .collapsible-content{max-height:0;overflow:hidden;transition:max-height 0.3s ease-out}
    .collapsible-content.open{max-height:3000px}
    .glass-effect{background:rgba(255,255,255,0.95);backdrop-filter:blur(10px)}
    .btn-primary{background:linear-gradient(135deg,#1a2654 0%,#0f172a 100%);transition:all 0.2s}
    .btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 15px rgba(26,38,84,0.3)}
    .input-field{border:2px solid #e2e8f0;transition:all 0.2s}
    .input-field:focus{border-color:#1a2654;box-shadow:0 0 0 3px rgba(26,38,84,0.1)}
    .pro-badge{background:linear-gradient(135deg,#F7BE0C,#d4a00a);color:#0f172a;font-size:10px;padding:2px 8px;border-radius:4px;font-weight:700}
    .market-open{color:#4ade80}
    .market-closed{color:#f87171}
    .pulse-green{animation:pulseGreen 2s infinite}
    .pulse-red{animation:pulseRed 2s infinite}
    @keyframes pulseGreen{0%,100%{box-shadow:0 0 0 0 rgba(74,222,128,0.7)}70%{box-shadow:0 0 0 6px rgba(74,222,128,0)}}
    @keyframes pulseRed{0%,100%{box-shadow:0 0 0 0 rgba(248,113,113,0.7)}70%{box-shadow:0 0 0 6px rgba(248,113,113,0)}}
    /* POPUP STYLES */
    .popup-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(8px);z-index:100;display:flex;align-items:center;justify-content:center;padding:1rem;opacity:0;visibility:hidden;transition:all 0.3s ease}
    .popup-overlay.active{opacity:1;visibility:visible}
    .popup-container{background:linear-gradient(145deg,#1a2654 0%,#0f172a 100%);border-radius:24px;max-width:420px;width:100%;transform:scale(0.9) translateY(20px);transition:all 0.4s cubic-bezier(0.175,0.885,0.32,1.275);box-shadow:0 25px 80px rgba(0,0,0,0.5),0 0 0 1px rgba(247,190,12,0.2);overflow:hidden}
    .popup-overlay.active .popup-container{transform:scale(1) translateY(0)}
    .popup-header{background:linear-gradient(135deg,#F7BE0C 0%,#d4a00a 100%);padding:1rem;text-align:center;position:relative}
    .popup-free-badge{display:inline-block;background:#fff;color:#0f172a;font-weight:800;font-size:14px;padding:6px 20px;border-radius:50px;box-shadow:0 4px 15px rgba(0,0,0,0.2);animation:bounce 2s infinite}
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
    .popup-content{padding:1.5rem}
    .popup-title{color:#fff;font-size:1.75rem;font-weight:800;text-align:center;margin-bottom:0.5rem;text-shadow:0 2px 10px rgba(0,0,0,0.3)}
    .popup-subtitle{color:rgba(255,255,255,0.7);text-align:center;font-size:0.9rem;margin-bottom:1.5rem}
    .popup-features{display:grid;grid-template-columns:1fr 1fr;gap:0.75rem;margin-bottom:1.5rem}
    .popup-feature{background:rgba(255,255,255,0.1);border-radius:12px;padding:0.75rem;display:flex;align-items:center;gap:0.5rem;color:#fff;font-size:0.85rem;font-weight:500;border:1px solid rgba(255,255,255,0.1);transition:all 0.2s}
    .popup-feature:hover{background:rgba(255,255,255,0.15);transform:translateY(-2px)}
    .popup-feature-icon{font-size:1.2rem}
    .popup-buttons{display:flex;flex-direction:column;gap:0.75rem}
    .popup-btn{display:flex;align-items:center;justify-content:center;gap:0.75rem;padding:1rem 1.5rem;border-radius:14px;font-weight:700;font-size:1rem;text-decoration:none;transition:all 0.2s;border:none;cursor:pointer}
    .popup-btn-kick{background:linear-gradient(135deg,#53fc18 0%,#3dbb13 100%);color:#000}
    .popup-btn-kick:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(83,252,24,0.4)}
    .popup-btn-telegram{background:linear-gradient(135deg,#0088cc 0%,#006699 100%);color:#fff}
    .popup-btn-telegram:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,136,204,0.4)}
    .popup-btn-instagram{background:linear-gradient(135deg,#f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);color:#fff}
    .popup-btn-instagram:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(225,48,108,0.4)}
    .popup-close{position:absolute;top:1rem;right:1rem;background:rgba(255,255,255,0.2);border:none;color:#fff;width:32px;height:32px;border-radius:50%;cursor:pointer;font-size:1.25rem;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
    .popup-close:hover{background:rgba(255,255,255,0.3);transform:rotate(90deg)}
    .popup-footer{text-align:center;padding-top:0.5rem}
    .popup-later{background:none;border:none;color:rgba(255,255,255,0.5);font-size:0.8rem;cursor:pointer;text-decoration:underline;transition:color 0.2s}
    .popup-later:hover{color:rgba(255,255,255,0.8)}
    .sparkle{position:absolute;width:10px;height:10px;background:#fff;border-radius:50%;animation:sparkle 1.5s infinite}
    .sparkle:nth-child(1){top:20%;left:10%;animation-delay:0s}
    .sparkle:nth-child(2){top:60%;left:5%;animation-delay:0.3s}
    .sparkle:nth-child(3){top:30%;right:10%;animation-delay:0.6s}
    .sparkle:nth-child(4){top:70%;right:8%;animation-delay:0.9s}
    @keyframes sparkle{0%,100%{opacity:0;transform:scale(0)}50%{opacity:1;transform:scale(1)}}
  </style>
</head>
<body class="text-neutral-900 min-h-screen">
  
  <!-- POPUP PROMOCIONAL -->
  <div id="promoPopup" class="popup-overlay">
    <div class="popup-container">
      <!-- Sparkles decorativos -->
      <div class="sparkle"></div>
      <div class="sparkle"></div>
      <div class="sparkle"></div>
      <div class="sparkle"></div>
      
      <!-- Header con badge -->
      <div class="popup-header">
        <span class="popup-free-badge">‚ú® 100% GRATIS ‚ú®</span>
        <button class="popup-close" onclick="closePopup()">√ó</button>
      </div>
      
      <!-- Contenido -->
      <div class="popup-content">
        <h2 class="popup-title">üéì CLASES EN VIVO</h2>
        <p class="popup-subtitle">√önete a nuestra comunidad y aprende trading desde cero</p>
        
        <!-- Features -->
        <div class="popup-features">
          <div class="popup-feature">
            <span class="popup-feature-icon">üìö</span>
            <span>Mentor√≠as</span>
          </div>
          <div class="popup-feature">
            <span class="popup-feature-icon">üìä</span>
            <span>Indicadores</span>
          </div>
          <div class="popup-feature">
            <span class="popup-feature-icon">ü§ñ</span>
            <span>Robots</span>
          </div>
          <div class="popup-feature">
            <span class="popup-feature-icon">üõ†Ô∏è</span>
            <span>Herramientas</span>
          </div>
        </div>
        
        <!-- Botones -->
        <div class="popup-buttons">
          <a href="https://kick.com/dieguinsebas" target="_blank" class="popup-btn popup-btn-kick">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M1.333 0v24h5.338v-7.997l6.666 7.997h8.003l-8.006-9.601L21.333 4.8h-8.001l-6.661 7.998V0z"/></svg>
            Seguir en Kick
          </a>
          <a href="https://t.me/comunidadDAfree" target="_blank" class="popup-btn popup-btn-telegram">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
            Unirse a Telegram
          </a>
          <a href="https://www.instagram.com/diego_albujaofficial/" target="_blank" class="popup-btn popup-btn-instagram">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
            Seguir en Instagram
          </a>
        </div>
        
        <!-- Footer -->
        <div class="popup-footer">
          <button class="popup-later" onclick="closePopup()">Quiz√°s m√°s tarde</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- HEADER PROFESIONAL -->
  <header class="header-gradient sticky top-0 z-50 shadow-xl">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex items-center justify-between h-20">
        <!-- Logo y nombre -->
        <div class="flex items-center gap-4">
          <img src="assets/logo.png" alt="DF Academy" class="h-14 w-auto logo-glow" />
          <div class="hidden sm:block">
            <div class="flex items-center gap-2">
              <h1 class="text-white text-xl font-bold tracking-wide">DF ACADEMY</h1>
              <span class="pro-badge">PRO</span>
            </div>
            <p class="text-white/60 text-xs font-medium tracking-wider">HERRAMIENTAS DE TRADING</p>
          </div>
        </div>
        
        <!-- Lado derecho - Estado del mercado din√°mico -->
        <div class="flex items-center gap-4">
          <div id="marketStatus" class="hidden md:flex items-center gap-2 text-sm">
            <!-- Se actualiza din√°micamente -->
          </div>
          <div class="bg-white/10 px-3 py-1.5 rounded-lg border border-white/20">
            <span class="text-white/90 text-sm font-semibold">v3.0</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- TICKER DE TRADINGVIEW -->
  <div class="ticker-wrapper">
    <div class="tradingview-widget-container">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      {
        "symbols": [
          {"proName":"FX:EURUSD","title":"EUR/USD"},
          {"proName":"OANDA:XAUUSD","title":"XAU/USD"},
          {"proName":"FX:GBPUSD","title":"GBP/USD"},
          {"proName":"FX:USDJPY","title":"USD/JPY"},
          {"proName":"CAPITALCOM:US500","title":"S&P 500"},
          {"proName":"CAPITALCOM:US100","title":"NASDAQ"},
          {"proName":"BINANCE:BTCUSDT","title":"BTC/USDT"},
          {"proName":"BINANCE:ETHUSDT","title":"ETH/USDT"}
        ],
        "showSymbolLogo": true,
        "isTransparent": true,
        "displayMode": "adaptive",
        "colorTheme": "dark",
        "locale": "es"
      }
      </script>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <main class="min-h-screen w-full">
    <section class="max-w-6xl mx-auto px-4 py-10">
      
      <!-- T√≠tulo de la p√°gina -->
      <div class="text-center mb-8">
        <h2 class="text-3xl sm:text-4xl font-extrabold tracking-tight text-brand">
          Calculadora de Posici√≥n
        </h2>
        <p class="mt-3 text-neutral-500 max-w-xl mx-auto">
          Calcula el tama√±o √≥ptimo de tu posici√≥n basado en tu gesti√≥n de riesgo profesional.
        </p>
        <div class="flex flex-wrap justify-center gap-2 mt-5">
          <span class="category-badge cat-forex">Forex</span>
          <span class="category-badge cat-metals">Metales</span>
          <span class="category-badge cat-energy">Energ√≠a</span>
          <span class="category-badge cat-indices">√çndices</span>
          <span class="category-badge cat-crypto">Cripto</span>
        </div>
      </div>

      <!-- GRID PRINCIPAL -->
      <div class="grid lg:grid-cols-2 gap-8">
        
        <!-- COLUMNA IZQUIERDA: PAR√ÅMETROS -->
        <div class="space-y-6">
          <div class="gradient-border shadow-lg">
            <div class="glass-effect rounded-xl p-6">
              <div class="flex items-center gap-3 mb-6">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-brand to-brandDark flex items-center justify-center">
                  <span class="text-2xl">‚öôÔ∏è</span>
                </div>
                <div>
                  <h3 class="text-lg font-bold text-brand">Par√°metros de Operaci√≥n</h3>
                  <p class="text-xs text-neutral-500">Configura los detalles de tu trade</p>
                </div>
              </div>

              <!-- Instrumento -->
              <div class="mb-5">
                <label class="block text-sm font-semibold text-neutral-700 mb-1.5">Instrumento</label>
                <select id="symbol" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none text-neutral-800">
                  <optgroup label="üìà FOREX - Mayores">
                    <option value="EURUSD">EUR/USD</option><option value="GBPUSD">GBP/USD</option><option value="USDJPY">USD/JPY</option>
                    <option value="USDCHF">USD/CHF</option><option value="AUDUSD">AUD/USD</option><option value="USDCAD">USD/CAD</option><option value="NZDUSD">NZD/USD</option>
                  </optgroup>
                  <optgroup label="üìä FOREX - Cruces EUR">
                    <option value="EURGBP">EUR/GBP</option><option value="EURJPY">EUR/JPY</option><option value="EURCHF">EUR/CHF</option>
                    <option value="EURAUD">EUR/AUD</option><option value="EURCAD">EUR/CAD</option><option value="EURNZD">EUR/NZD</option>
                  </optgroup>
                  <optgroup label="üìä FOREX - Cruces GBP">
                    <option value="GBPJPY">GBP/JPY</option><option value="GBPCHF">GBP/CHF</option><option value="GBPAUD">GBP/AUD</option>
                    <option value="GBPCAD">GBP/CAD</option><option value="GBPNZD">GBP/NZD</option>
                  </optgroup>
                  <optgroup label="üìä FOREX - Otros Cruces">
                    <option value="AUDJPY">AUD/JPY</option><option value="AUDCHF">AUD/CHF</option><option value="AUDCAD">AUD/CAD</option><option value="AUDNZD">AUD/NZD</option>
                    <option value="CADJPY">CAD/JPY</option><option value="CADCHF">CAD/CHF</option><option value="CHFJPY">CHF/JPY</option>
                    <option value="NZDJPY">NZD/JPY</option><option value="NZDCHF">NZD/CHF</option><option value="NZDCAD">NZD/CAD</option>
                  </optgroup>
                  <optgroup label="üåç FOREX - Ex√≥ticos">
                    <option value="USDMXN">USD/MXN</option><option value="USDZAR">USD/ZAR</option><option value="USDTRY">USD/TRY</option>
                    <option value="USDSEK">USD/SEK</option><option value="USDNOK">USD/NOK</option><option value="USDSGD">USD/SGD</option>
                    <option value="USDCNH">USD/CNH</option><option value="EURTRY">EUR/TRY</option><option value="EURMXN">EUR/MXN</option>
                  </optgroup>
                  <optgroup label="ü•á METALES (‚ö†Ô∏è Verificar)">
                    <option value="XAUUSD">XAU/USD (Oro)</option><option value="XAGUSD">XAG/USD (Plata)</option>
                  </optgroup>
                  <optgroup label="‚õΩ ENERG√çAS (‚ö†Ô∏è Verificar)">
                    <option value="USOIL">USOIL / WTI</option><option value="UKOIL">UKOIL / Brent</option><option value="NGAS">Gas Natural</option>
                  </optgroup>
                  <optgroup label="üìâ √çNDICES (‚ö†Ô∏è Verificar)">
                    <option value="US30">US30 / Dow Jones</option><option value="US500">US500 / S&P 500</option>
                    <option value="US100">US100 / NASDAQ</option><option value="GER40">GER40 / DAX</option>
                  </optgroup>
                  <optgroup label="‚Çø CRIPTOMONEDAS (‚ö†Ô∏è Verificar)">
                    <option value="BTCUSD">BTC/USD</option><option value="ETHUSD">ETH/USD</option>
                  </optgroup>
                </select>
                <div id="accuracyIndicator" class="mt-2">
                  <span id="accuracyBadge" class="accuracy-badge accuracy-high">‚úì Forex Universal</span>
                </div>
              </div>

              <!-- Divisa y Balance -->
              <div class="grid grid-cols-2 gap-4 mb-5">
                <div>
                  <label class="block text-sm font-semibold text-neutral-700 mb-1.5">Divisa Cuenta</label>
                  <select id="accountCcy" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none">
                    <option value="USD">USD</option><option value="EUR">EUR</option><option value="GBP">GBP</option>
                    <option value="JPY">JPY</option><option value="CHF">CHF</option><option value="AUD">AUD</option>
                    <option value="CAD">CAD</option><option value="NZD">NZD</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-semibold text-neutral-700 mb-1.5">Balance</label>
                  <input id="balance" type="number" step="0.01" value="1000" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none" />
                </div>
              </div>

              <!-- Riesgo y Stop Loss -->
              <div class="grid grid-cols-2 gap-4 mb-5">
                <div>
                  <label class="block text-sm font-semibold text-neutral-700 mb-1.5">Riesgo %</label>
                  <input id="riskPct" type="number" step="0.01" value="1" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none" />
                </div>
                <div>
                  <label class="block text-sm font-semibold text-neutral-700 mb-1.5">Stop Loss (pips)</label>
                  <input id="stopPips" type="number" step="0.1" value="20" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none" />
                </div>
              </div>

              <!-- Precio del Par -->
              <div id="priceSection" class="price-box rounded-xl p-4 mb-5">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-lg">üí±</span>
                  <label id="priceLabel" class="text-sm font-bold text-amber-800">Precio del Par</label>
                </div>
                <input id="pairPrice" type="number" step="0.00001" value="1.10000" class="w-full rounded-lg border-2 border-amber-300 bg-white px-4 py-3 focus:outline-none focus:border-amber-500 mono text-lg" />
                <p id="priceHelp" class="text-xs text-amber-700 mt-2">Ingresa el precio actual desde tu plataforma</p>
              </div>

              <!-- Conversi√≥n adicional -->
              <div id="conversionSection" class="bg-purple-50 border-2 border-purple-200 rounded-xl p-4 mb-5 hidden">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-lg">üîÑ</span>
                  <label id="conversionLabel" class="text-sm font-bold text-purple-800">Tipo de Cambio Adicional</label>
                </div>
                <input id="conversionRate" type="number" step="0.00001" value="1.00000" class="w-full rounded-lg border-2 border-purple-300 bg-white px-4 py-3 focus:outline-none mono" />
                <p id="conversionHelp" class="text-xs text-purple-700 mt-2"></p>
              </div>

              <!-- Botones -->
              <div class="flex items-center gap-3">
                <button id="btnCalc" class="flex-1 btn-primary px-6 py-3.5 rounded-xl text-white font-bold text-lg">
                  üìä Calcular
                </button>
                <button id="btnReset" class="px-5 py-3.5 rounded-xl border-2 border-neutral-300 font-semibold text-neutral-500 hover:bg-neutral-100 transition-colors">
                  ‚Ü∫
                </button>
              </div>
            </div>
          </div>

          <!-- Especificaciones Broker -->
          <div id="brokerSection" class="bg-white rounded-xl shadow-md border border-neutral-200 overflow-hidden hidden">
            <div id="brokerToggle" class="collapsible-header p-4 flex items-center justify-between hover:bg-neutral-50 transition-colors">
              <div class="flex items-center gap-3">
                <span class="text-xl">üîß</span>
                <div>
                  <h3 class="font-bold text-brand">Especificaciones del Broker</h3>
                  <p class="text-xs text-neutral-500">Para activos no-Forex</p>
                </div>
              </div>
              <span id="brokerArrow" class="text-neutral-400 transition-transform">‚ñº</span>
            </div>
            <div id="brokerContent" class="collapsible-content">
              <div class="px-4 pb-4 border-t">
                <div class="info-box rounded-lg p-3 mt-4 text-sm">
                  <p class="text-blue-700">Verifica el <b>Tama√±o de Contrato</b> y <b>Valor del Tick</b> en tu plataforma.</p>
                </div>
                <div class="mt-4 grid grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-semibold text-neutral-700 mb-1">Tama√±o Contrato</label>
                    <input id="brokerLotSize" type="number" step="0.01" value="100" class="w-full rounded-lg border-2 border-amber-200 bg-amber-50 px-3 py-2 mono" />
                  </div>
                  <div>
                    <label class="block text-sm font-semibold text-neutral-700 mb-1">Valor Tick/Lote</label>
                    <input id="brokerTickValue" type="number" step="0.01" value="1" class="w-full rounded-lg border-2 border-amber-200 bg-amber-50 px-3 py-2 mono" />
                  </div>
                </div>
                <button id="btnApplyBroker" class="mt-4 w-full px-4 py-2.5 rounded-lg bg-amber-500 text-white font-semibold hover:bg-amber-600 transition-colors">‚úì Aplicar</button>
              </div>
            </div>
          </div>
        </div>

        <!-- COLUMNA DERECHA: RESULTADOS -->
        <div class="space-y-6">
          <div class="bg-white rounded-2xl shadow-lg border border-neutral-200 p-6">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-accent to-accentDark flex items-center justify-center">
                <span class="text-2xl">üìä</span>
              </div>
              <div>
                <h3 class="text-lg font-bold text-brand">Resultados</h3>
                <p class="text-xs text-neutral-500">Tu tama√±o de posici√≥n √≥ptimo</p>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="result-card rounded-xl bg-gradient-to-br from-red-50 to-red-100 border border-red-200 p-4">
                <p class="text-sm text-red-600 font-semibold">üí∞ Riesgo</p>
                <p id="riskMoneyOut" class="text-2xl font-bold mt-1 mono text-red-700">‚Äî</p>
              </div>
              <div class="result-card rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 p-4">
                <p class="text-sm text-blue-600 font-semibold">üìè Pip/Lote</p>
                <p id="pipValueOut" class="text-xl font-bold mt-1 mono text-blue-700">‚Äî</p>
              </div>
              <div class="result-card rounded-xl bg-gradient-to-br from-indigo-50 to-indigo-100 border border-indigo-200 p-4">
                <p class="text-sm text-indigo-600 font-semibold">üì¶ Unidades</p>
                <p id="unitsOut" class="text-2xl font-bold mt-1 mono text-indigo-700">‚Äî</p>
              </div>
              <div class="result-card rounded-xl bg-gradient-to-br from-amber-50 to-amber-100 border border-amber-200 p-4">
                <p class="text-sm text-amber-700 font-semibold">üéØ Lotes</p>
                <p id="lotsOut" class="text-2xl font-bold mt-1 mono text-amber-800">‚Äî</p>
              </div>
              <div class="result-card rounded-xl bg-gradient-to-br from-green-50 to-green-100 border border-green-200 p-4">
                <p class="text-sm text-green-600 font-semibold">Mini (0.1)</p>
                <p id="miniOut" class="text-xl font-bold mt-1 mono text-green-700">‚Äî</p>
              </div>
              <div class="result-card rounded-xl bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 p-4">
                <p class="text-sm text-purple-600 font-semibold">Micro (0.01)</p>
                <p id="microOut" class="text-xl font-bold mt-1 mono text-purple-700">‚Äî</p>
              </div>
            </div>
          </div>

          <!-- F√≥rmula -->
          <div class="bg-white rounded-2xl shadow-lg border border-neutral-200 p-6">
            <h3 class="font-bold text-brand mb-4 flex items-center gap-2">
              <span>üìê</span> Desglose del C√°lculo
            </h3>
            <div id="formulaExplanation" class="text-sm space-y-2 bg-neutral-50 p-4 rounded-xl border border-neutral-200"></div>
          </div>

          <!-- Info conversi√≥n -->
          <div class="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-2xl p-5">
            <h3 class="font-bold text-purple-800 mb-2 flex items-center gap-2">
              <span>üí±</span> Sobre la Conversi√≥n
            </h3>
            <p id="conversionExplanation" class="text-sm text-purple-700"></p>
          </div>
        </div>
      </div>

      <!-- ============================================= -->
      <!-- CALCULADORA DE INTER√âS COMPUESTO -->
      <!-- ============================================= -->
      <div class="mt-16 mb-12">
        <div class="text-center mb-8">
          <h2 class="text-3xl sm:text-4xl font-extrabold tracking-tight text-brand">
            üìà Calculadora de Inter√©s Compuesto
          </h2>
          <p class="mt-3 text-neutral-500 max-w-xl mx-auto">
            Visualiza el crecimiento potencial de tu cuenta con ganancias consistentes.
          </p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
          <!-- COLUMNA IZQUIERDA: PAR√ÅMETROS -->
          <div class="gradient-border shadow-lg">
            <div class="glass-effect rounded-xl p-6">
              <div class="flex items-center gap-3 mb-6">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-green-700 flex items-center justify-center">
                  <span class="text-2xl">üí∞</span>
                </div>
                <div>
                  <h3 class="text-lg font-bold text-brand">Par√°metros de Inversi√≥n</h3>
                  <p class="text-xs text-neutral-500">Configura tu proyecci√≥n de crecimiento</p>
                </div>
              </div>

              <!-- Capital Inicial -->
              <div class="mb-5">
                <label class="block text-sm font-semibold text-neutral-700 mb-1.5">üíµ Capital Inicial</label>
                <input id="compoundCapital" type="number" step="0.01" value="1000" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none" />
              </div>

              <!-- Ganancia por per√≠odo -->
              <div class="grid grid-cols-2 gap-4 mb-5">
                <div>
                  <label class="block text-sm font-semibold text-neutral-700 mb-1.5">üìä Ganancia %</label>
                  <input id="compoundGain" type="number" step="0.1" value="5" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none" />
                </div>
                <div>
                  <label class="block text-sm font-semibold text-neutral-700 mb-1.5">üìÖ Per√≠odo</label>
                  <select id="compoundPeriod" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none">
                    <option value="daily">Diario</option>
                    <option value="weekly" selected>Semanal</option>
                    <option value="monthly">Mensual</option>
                  </select>
                </div>
              </div>

              <!-- N√∫mero de per√≠odos -->
              <div class="mb-5">
                <label class="block text-sm font-semibold text-neutral-700 mb-1.5">üîÑ N√∫mero de Per√≠odos</label>
                <input id="compoundPeriods" type="number" step="1" value="12" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none" />
                <p id="compoundPeriodHelp" class="text-xs text-neutral-500 mt-1">12 semanas = ~3 meses</p>
              </div>

              <!-- Aportes adicionales -->
              <div class="mb-5">
                <label class="block text-sm font-semibold text-neutral-700 mb-1.5">‚ûï Aporte adicional por per√≠odo (opcional)</label>
                <input id="compoundDeposit" type="number" step="0.01" value="0" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none" />
              </div>

              <!-- Retiros -->
              <div class="mb-5">
                <label class="block text-sm font-semibold text-neutral-700 mb-1.5">‚ûñ Retiro por per√≠odo (opcional)</label>
                <input id="compoundWithdraw" type="number" step="0.01" value="0" class="w-full rounded-xl input-field px-4 py-3 focus:outline-none" />
              </div>

              <!-- Bot√≥n calcular -->
              <button id="btnCompoundCalc" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 px-6 py-3.5 rounded-xl text-white font-bold text-lg transition-all hover:shadow-lg hover:shadow-green-500/30">
                üìà Calcular Crecimiento
              </button>
            </div>
          </div>

          <!-- COLUMNA DERECHA: RESULTADOS -->
          <div class="space-y-6">
            <!-- Resumen -->
            <div class="bg-white rounded-2xl shadow-lg border border-neutral-200 p-6">
              <div class="flex items-center gap-3 mb-6">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center">
                  <span class="text-2xl">üéØ</span>
                </div>
                <div>
                  <h3 class="text-lg font-bold text-brand">Resultados</h3>
                  <p class="text-xs text-neutral-500">Tu proyecci√≥n de crecimiento</p>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div class="result-card rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 p-4">
                  <p class="text-sm text-blue-600 font-semibold">üíµ Capital Inicial</p>
                  <p id="compoundInitialOut" class="text-2xl font-bold mt-1 mono text-blue-700">$1,000</p>
                </div>
                <div class="result-card rounded-xl bg-gradient-to-br from-green-50 to-green-100 border border-green-200 p-4">
                  <p class="text-sm text-green-600 font-semibold">üèÜ Capital Final</p>
                  <p id="compoundFinalOut" class="text-2xl font-bold mt-1 mono text-green-700">‚Äî</p>
                </div>
                <div class="result-card rounded-xl bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 p-4">
                  <p class="text-sm text-purple-600 font-semibold">üìà Ganancia Total</p>
                  <p id="compoundProfitOut" class="text-2xl font-bold mt-1 mono text-purple-700">‚Äî</p>
                </div>
                <div class="result-card rounded-xl bg-gradient-to-br from-amber-50 to-amber-100 border border-amber-200 p-4">
                  <p class="text-sm text-amber-700 font-semibold">üìä Rendimiento %</p>
                  <p id="compoundPercentOut" class="text-2xl font-bold mt-1 mono text-amber-800">‚Äî</p>
                </div>
              </div>
            </div>

            <!-- Gr√°fico -->
            <div class="bg-white rounded-2xl shadow-lg border border-neutral-200 p-6">
              <h3 class="font-bold text-brand mb-4 flex items-center gap-2">
                <span>üìä</span> Gr√°fico de Crecimiento
              </h3>
              <div class="relative h-64 bg-neutral-50 rounded-xl border border-neutral-200 overflow-hidden">
                <canvas id="compoundChart"></canvas>
              </div>
            </div>

            <!-- Tabla de desglose -->
            <div class="bg-white rounded-2xl shadow-lg border border-neutral-200 p-6">
              <h3 class="font-bold text-brand mb-4 flex items-center gap-2">
                <span>üìã</span> Desglose por Per√≠odo
              </h3>
              <div class="max-h-64 overflow-y-auto rounded-xl border border-neutral-200">
                <table class="w-full text-sm">
                  <thead class="bg-neutral-100 sticky top-0">
                    <tr>
                      <th class="px-3 py-2 text-left font-semibold text-neutral-700">#</th>
                      <th class="px-3 py-2 text-right font-semibold text-neutral-700">Capital</th>
                      <th class="px-3 py-2 text-right font-semibold text-neutral-700">Ganancia</th>
                      <th class="px-3 py-2 text-right font-semibold text-neutral-700">Total</th>
                    </tr>
                  </thead>
                  <tbody id="compoundTableBody" class="divide-y divide-neutral-100">
                    <!-- Se llena din√°micamente -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="mt-12 text-center">
        <div class="flex items-center justify-center gap-3 mb-3">
          <img src="assets/logo.png" alt="DF Academy" class="h-10 w-auto opacity-80" />
          <span class="text-neutral-400 font-semibold">DF ACADEMY</span>
        </div>
        <p class="text-xs text-neutral-400">¬© 2025 ¬∑ Herramienta educativa. No constituye asesor√≠a financiera.</p>
      </div>
    </section>
  </main>

  <script>
    // =============================================
    // ESTADO DEL MERCADO FOREX (UTC)
    // Forex: Domingo 22:00 UTC - Viernes 22:00 UTC
    // =============================================
    function updateMarketStatus() {
      const now = new Date();
      const utcDay = now.getUTCDay(); // 0=Domingo, 6=S√°bado
      const utcHour = now.getUTCHours();
      
      let isOpen = false;
      let sessionName = '';
      
      // Forex est√° cerrado: Viernes despu√©s de 22:00 UTC hasta Domingo 22:00 UTC
      if (utcDay === 6) {
        // S√°bado - cerrado
        isOpen = false;
      } else if (utcDay === 0) {
        // Domingo - abre a las 22:00 UTC
        isOpen = utcHour >= 22;
      } else if (utcDay === 5) {
        // Viernes - cierra a las 22:00 UTC
        isOpen = utcHour < 22;
      } else {
        // Lunes a Jueves - abierto 24h
        isOpen = true;
      }
      
      // Determinar sesi√≥n activa
      if (isOpen) {
        if (utcHour >= 22 || utcHour < 7) {
          sessionName = 'Sydney/Tokyo';
        } else if (utcHour >= 7 && utcHour < 8) {
          sessionName = 'Tokyo';
        } else if (utcHour >= 8 && utcHour < 12) {
          sessionName = 'Londres';
        } else if (utcHour >= 12 && utcHour < 17) {
          sessionName = 'Londres/NY';
        } else if (utcHour >= 17 && utcHour < 22) {
          sessionName = 'Nueva York';
        }
      }
      
      const statusEl = document.getElementById('marketStatus');
      if (isOpen) {
        statusEl.innerHTML = `
          <span class="inline-block w-2.5 h-2.5 bg-green-400 rounded-full pulse-green"></span>
          <span class="text-green-400 font-medium">Mercado Abierto</span>
          <span class="text-white/50 text-xs ml-1">${sessionName}</span>
        `;
      } else {
        statusEl.innerHTML = `
          <span class="inline-block w-2.5 h-2.5 bg-red-400 rounded-full pulse-red"></span>
          <span class="text-red-400 font-medium">Mercado Cerrado</span>
          <span class="text-white/50 text-xs ml-1">Fin de semana</span>
        `;
      }
    }
    
    // Actualizar estado cada minuto
    updateMarketStatus();
    setInterval(updateMarketStatus, 60000);

    // =============================================
    // BASE DE DATOS
    // =============================================
    const FX_PAIRS = {
      EURUSD:{base:'EUR',quote:'USD',pip:0.0001,price:1.1000},
      GBPUSD:{base:'GBP',quote:'USD',pip:0.0001,price:1.2700},
      USDJPY:{base:'USD',quote:'JPY',pip:0.01,price:156.50},
      USDCHF:{base:'USD',quote:'CHF',pip:0.0001,price:0.8800},
      AUDUSD:{base:'AUD',quote:'USD',pip:0.0001,price:0.6600},
      USDCAD:{base:'USD',quote:'CAD',pip:0.0001,price:1.3600},
      NZDUSD:{base:'NZD',quote:'USD',pip:0.0001,price:0.6100},
      EURGBP:{base:'EUR',quote:'GBP',pip:0.0001,price:0.8650},
      EURJPY:{base:'EUR',quote:'JPY',pip:0.01,price:164.00},
      EURCHF:{base:'EUR',quote:'CHF',pip:0.0001,price:0.9700},
      EURAUD:{base:'EUR',quote:'AUD',pip:0.0001,price:1.6700},
      EURCAD:{base:'EUR',quote:'CAD',pip:0.0001,price:1.5000},
      EURNZD:{base:'EUR',quote:'NZD',pip:0.0001,price:1.8100},
      GBPJPY:{base:'GBP',quote:'JPY',pip:0.01,price:189.00},
      GBPCHF:{base:'GBP',quote:'CHF',pip:0.0001,price:1.1200},
      GBPAUD:{base:'GBP',quote:'AUD',pip:0.0001,price:1.9300},
      GBPCAD:{base:'GBP',quote:'CAD',pip:0.0001,price:1.7300},
      GBPNZD:{base:'GBP',quote:'NZD',pip:0.0001,price:2.1000},
      AUDJPY:{base:'AUD',quote:'JPY',pip:0.01,price:98.00},
      AUDCHF:{base:'AUD',quote:'CHF',pip:0.0001,price:0.5800},
      AUDCAD:{base:'AUD',quote:'CAD',pip:0.0001,price:0.9000},
      AUDNZD:{base:'AUD',quote:'NZD',pip:0.0001,price:1.0900},
      CADJPY:{base:'CAD',quote:'JPY',pip:0.01,price:110.00},
      CADCHF:{base:'CAD',quote:'CHF',pip:0.0001,price:0.6500},
      CHFJPY:{base:'CHF',quote:'JPY',pip:0.01,price:169.00},
      NZDJPY:{base:'NZD',quote:'JPY',pip:0.01,price:90.00},
      NZDCHF:{base:'NZD',quote:'CHF',pip:0.0001,price:0.5400},
      NZDCAD:{base:'NZD',quote:'CAD',pip:0.0001,price:0.8300},
      USDMXN:{base:'USD',quote:'MXN',pip:0.0001,price:17.50},
      USDZAR:{base:'USD',quote:'ZAR',pip:0.0001,price:18.50},
      USDTRY:{base:'USD',quote:'TRY',pip:0.0001,price:32.00},
      USDSEK:{base:'USD',quote:'SEK',pip:0.0001,price:10.50},
      USDNOK:{base:'USD',quote:'NOK',pip:0.0001,price:10.80},
      USDSGD:{base:'USD',quote:'SGD',pip:0.0001,price:1.35},
      USDCNH:{base:'USD',quote:'CNH',pip:0.0001,price:7.25},
      EURTRY:{base:'EUR',quote:'TRY',pip:0.0001,price:35.00},
      EURMXN:{base:'EUR',quote:'MXN',pip:0.0001,price:19.20}
    };

    const NON_FX = {
      XAUUSD:{quote:'USD',lotSize:100,tickVal:1,note:'Oro'},
      XAGUSD:{quote:'USD',lotSize:5000,tickVal:50,note:'Plata'},
      USOIL:{quote:'USD',lotSize:100,tickVal:1,note:'WTI'},
      UKOIL:{quote:'USD',lotSize:100,tickVal:1,note:'Brent'},
      NGAS:{quote:'USD',lotSize:10000,tickVal:10,note:'Gas'},
      US30:{quote:'USD',lotSize:1,tickVal:1,note:'Dow'},
      US500:{quote:'USD',lotSize:1,tickVal:0.1,note:'S&P'},
      US100:{quote:'USD',lotSize:1,tickVal:0.1,note:'NAS'},
      GER40:{quote:'EUR',lotSize:1,tickVal:0.1,note:'DAX'},
      BTCUSD:{quote:'USD',lotSize:1,tickVal:1,note:'BTC'},
      ETHUSD:{quote:'USD',lotSize:1,tickVal:0.1,note:'ETH'}
    };

    const CONVERSION_RATES = {
      USDJPY:156.50,USDCHF:0.88,USDCAD:1.36,USDMXN:17.50,USDZAR:18.50,
      USDTRY:32.00,USDSEK:10.50,USDNOK:10.80,USDSGD:1.35,USDCNH:7.25,
      EURUSD:1.10,GBPUSD:1.27,AUDUSD:0.66,NZDUSD:0.61,EURGBP:0.865
    };

    let customBroker = {enabled:false,lotSize:100,tickValue:1};

    function getSymbolInfo(symbol) {
      if(FX_PAIRS[symbol]) return {type:'forex',...FX_PAIRS[symbol]};
      if(NON_FX[symbol]) return {type:'other',...NON_FX[symbol]};
      return null;
    }

    function analyzeConversion(symbol, accountCcy) {
      const info = getSymbolInfo(symbol);
      if(!info) return {needsPrice:false};
      const quote = info.quote;
      if(accountCcy === quote) return {needsPrice:false,direct:true,message:`Cuenta (${accountCcy}) = Cotizada. Directo.`};
      if(info.type === 'forex') {
        if(accountCcy === 'USD') {
          if(['JPY','CHF','CAD','MXN','ZAR','TRY','SEK','NOK','SGD','CNH'].includes(quote)) {
            return {needsPrice:true,priceType:'pair',operation:'divide',message:`Dividir por precio para ${quote} ‚Üí USD`,defaultPrice:info.price};
          }
          if(['GBP','EUR','AUD','NZD'].includes(quote)) {
            const convPair = quote + 'USD';
            return {needsPrice:true,priceType:'conversion',operation:'multiply',conversionPair:convPair,message:`Multiplicar por ${convPair} para ${quote} ‚Üí USD`,defaultPrice:info.price,defaultConversion:CONVERSION_RATES[convPair]||1};
          }
        }
        return {needsPrice:true,priceType:'pair',operation:'divide',message:`Convertir ${quote} ‚Üí ${accountCcy}`,defaultPrice:info.price};
      }
      return {needsPrice:quote!==accountCcy,priceType:'broker',message:info.note+' - Verificar broker'};
    }

    function updateUI() {
      const symbol = document.getElementById('symbol').value;
      const accountCcy = document.getElementById('accountCcy').value;
      const info = getSymbolInfo(symbol);
      const conv = analyzeConversion(symbol,accountCcy);

      document.getElementById('brokerSection').classList.toggle('hidden',info?.type==='forex');

      const priceSection = document.getElementById('priceSection');
      const priceLabel = document.getElementById('priceLabel');
      const priceHelp = document.getElementById('priceHelp');
      const priceInput = document.getElementById('pairPrice');

      if(conv.needsPrice || info?.type==='forex') {
        priceSection.classList.remove('hidden');
        priceLabel.textContent = `Precio de ${symbol}`;
        priceHelp.textContent = conv.message || 'Ingresa el precio actual';
        priceInput.value = conv.defaultPrice || info?.price || 1;
      } else {
        priceSection.classList.add('hidden');
      }

      const convSection = document.getElementById('conversionSection');
      if(conv.operation==='multiply' && conv.conversionPair) {
        convSection.classList.remove('hidden');
        document.getElementById('conversionLabel').textContent = `Precio de ${conv.conversionPair}`;
        document.getElementById('conversionHelp').textContent = `Para convertir a ${accountCcy}`;
        document.getElementById('conversionRate').value = conv.defaultConversion || 1;
      } else {
        convSection.classList.add('hidden');
      }

      const badge = document.getElementById('accuracyBadge');
      if(info?.type==='forex') {
        badge.className = 'accuracy-badge accuracy-high';
        badge.textContent = '‚úì Forex Universal';
      } else {
        badge.className = 'accuracy-badge accuracy-low';
        badge.textContent = '‚ö†Ô∏è Verificar Broker';
      }
      document.getElementById('conversionExplanation').textContent = conv.message || 'Sin conversi√≥n necesaria';
      recalc();
    }

    function recalc() {
      const symbol = document.getElementById('symbol').value;
      const accountCcy = document.getElementById('accountCcy').value;
      const balance = Number(document.getElementById('balance').value) || 0;
      const riskPct = Number(document.getElementById('riskPct').value) || 0;
      const stopPips = Number(document.getElementById('stopPips').value) || 1;
      const pairPrice = Number(document.getElementById('pairPrice').value) || 1;
      const conversionRate = Number(document.getElementById('conversionRate').value) || 1;

      const info = getSymbolInfo(symbol);
      const conv = analyzeConversion(symbol,accountCcy);
      const riskMoney = balance * (riskPct/100);

      let pipValuePerLot,lots,units,lotSize;
      let steps = [];

      if(info?.type==='forex') {
        lotSize = 100000;
        const pipSize = info.pip;
        const quote = info.quote;
        const pipInQuote = pipSize * lotSize;
        steps.push(`1. Pip en ${quote}: ${pipSize} √ó ${lotSize.toLocaleString()} = <b>${pipInQuote.toLocaleString()} ${quote}</b>`);

        if(accountCcy===quote) {
          pipValuePerLot = pipInQuote;
          steps.push(`2. Sin conversi√≥n (cuenta = cotizada)`);
        } else if(conv.operation==='divide') {
          pipValuePerLot = pipInQuote / pairPrice;
          steps.push(`2. ${pipInQuote.toLocaleString()} ${quote} √∑ ${pairPrice} = <b>${pipValuePerLot.toFixed(2)} ${accountCcy}</b>`);
        } else if(conv.operation==='multiply') {
          pipValuePerLot = pipInQuote * conversionRate;
          steps.push(`2. ${pipInQuote.toLocaleString()} ${quote} √ó ${conversionRate} = <b>${pipValuePerLot.toFixed(2)} ${accountCcy}</b>`);
        } else {
          pipValuePerLot = pipInQuote / pairPrice;
          steps.push(`2. ${pipInQuote.toLocaleString()} √∑ ${pairPrice} = <b>${pipValuePerLot.toFixed(2)} ${accountCcy}</b>`);
        }

        lots = riskMoney / (stopPips * pipValuePerLot);
        units = lots * lotSize;
        steps.push(`3. Riesgo: ${balance} √ó ${riskPct}% = <b>${riskMoney.toFixed(2)} ${accountCcy}</b>`);
        steps.push(`4. Lotes: ${riskMoney.toFixed(2)} √∑ (${stopPips} √ó ${pipValuePerLot.toFixed(2)}) = <b class="text-green-600">${lots.toFixed(2)}</b>`);
        steps.push(`5. Unidades: <b class="text-green-600">${Math.round(units).toLocaleString()}</b>`);

      } else if(info) {
        lotSize = customBroker.enabled ? customBroker.lotSize : info.lotSize;
        pipValuePerLot = customBroker.enabled ? customBroker.tickValue : info.tickVal;
        lots = riskMoney / (stopPips * pipValuePerLot);
        units = lots * lotSize;
        steps.push(`Valor tick: <b>${pipValuePerLot} ${accountCcy}</b>`);
        steps.push(`Lotes: ${riskMoney.toFixed(2)} √∑ (${stopPips} √ó ${pipValuePerLot}) = <b class="text-green-600">${lots.toFixed(2)}</b>`);
        if(!customBroker.enabled) steps.push(`<span class="text-amber-600">‚ö†Ô∏è Valores por defecto</span>`);
      } else {
        lots=0;units=0;pipValuePerLot=0;lotSize=100000;
      }

      document.getElementById('riskMoneyOut').textContent = riskMoney.toFixed(2)+' '+accountCcy;
      document.getElementById('pipValueOut').textContent = pipValuePerLot.toFixed(2)+' '+accountCcy;
      document.getElementById('unitsOut').textContent = Math.round(units).toLocaleString();
      document.getElementById('lotsOut').textContent = lots.toFixed(2);
      document.getElementById('miniOut').textContent = (lots*10).toFixed(2);
      document.getElementById('microOut').textContent = (lots*100).toFixed(1);
      document.getElementById('formulaExplanation').innerHTML = steps.map(s=>`<div class="py-1.5 border-b border-neutral-200 last:border-0">${s}</div>`).join('');
    }

    function resetForm() {
      document.getElementById('symbol').value = 'EURUSD';
      document.getElementById('accountCcy').value = 'USD';
      document.getElementById('balance').value = 1000;
      document.getElementById('riskPct').value = 1;
      document.getElementById('stopPips').value = 20;
      customBroker.enabled = false;
      updateUI();
    }

    function applyBrokerSpecs() {
      customBroker.enabled = true;
      customBroker.lotSize = Number(document.getElementById('brokerLotSize').value)||100;
      customBroker.tickValue = Number(document.getElementById('brokerTickValue').value)||1;
      recalc();
      const btn = document.getElementById('btnApplyBroker');
      btn.textContent = '‚úì Aplicado!';
      btn.classList.replace('bg-amber-500','bg-green-500');
      setTimeout(()=>{btn.textContent='‚úì Aplicar';btn.classList.replace('bg-green-500','bg-amber-500');},1500);
    }

    document.getElementById('symbol').addEventListener('change',updateUI);
    document.getElementById('accountCcy').addEventListener('change',updateUI);
    ['balance','riskPct','stopPips','pairPrice','conversionRate'].forEach(id=>{
      document.getElementById(id).addEventListener('input',recalc);
    });
    document.getElementById('btnCalc').addEventListener('click',recalc);
    document.getElementById('btnReset').addEventListener('click',resetForm);
    document.getElementById('btnApplyBroker').addEventListener('click',applyBrokerSpecs);

    document.getElementById('brokerToggle')?.addEventListener('click',()=>{
      document.getElementById('brokerContent').classList.toggle('open');
      document.getElementById('brokerArrow').style.transform = document.getElementById('brokerContent').classList.contains('open')?'rotate(180deg)':'';
    });

    updateUI();

    // =============================================
    // POPUP PROMOCIONAL
    // =============================================
    function closePopup() {
      document.getElementById('promoPopup').classList.remove('active');
    }

    function showPopup() {
      // Mostrar popup cada vez que se abre la p√°gina
      setTimeout(() => {
        document.getElementById('promoPopup').classList.add('active');
      }, 1500); // Mostrar despu√©s de 1.5 segundos
    }

    // Cerrar popup al hacer click fuera
    document.getElementById('promoPopup').addEventListener('click', (e) => {
      if (e.target === document.getElementById('promoPopup')) {
        closePopup();
      }
    });

    // Cerrar con ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closePopup();
    });

    // Mostrar popup al cargar
    showPopup();

    // =============================================
    // CALCULADORA DE INTER√âS COMPUESTO
    // =============================================
    let compoundChart = null;

    function updatePeriodHelp() {
      const periods = parseInt(document.getElementById('compoundPeriods').value) || 0;
      const periodType = document.getElementById('compoundPeriod').value;
      let helpText = '';
      
      if (periodType === 'daily') {
        const weeks = (periods / 7).toFixed(1);
        const months = (periods / 30).toFixed(1);
        helpText = `${periods} d√≠as = ~${weeks} semanas = ~${months} meses`;
      } else if (periodType === 'weekly') {
        const months = (periods / 4.33).toFixed(1);
        const years = (periods / 52).toFixed(1);
        helpText = `${periods} semanas = ~${months} meses` + (periods >= 52 ? ` = ~${years} a√±os` : '');
      } else if (periodType === 'monthly') {
        const years = (periods / 12).toFixed(1);
        helpText = `${periods} meses` + (periods >= 12 ? ` = ~${years} a√±os` : '');
      }
      
      document.getElementById('compoundPeriodHelp').textContent = helpText;
    }

    function calculateCompound() {
      const capital = parseFloat(document.getElementById('compoundCapital').value) || 0;
      const gainPercent = parseFloat(document.getElementById('compoundGain').value) || 0;
      const periods = parseInt(document.getElementById('compoundPeriods').value) || 0;
      const deposit = parseFloat(document.getElementById('compoundDeposit').value) || 0;
      const withdraw = parseFloat(document.getElementById('compoundWithdraw').value) || 0;
      
      const gainRate = gainPercent / 100;
      let currentCapital = capital;
      const data = [{ period: 0, capital: capital, gain: 0, total: capital }];
      
      for (let i = 1; i <= periods; i++) {
        const gain = currentCapital * gainRate;
        currentCapital = currentCapital + gain + deposit - withdraw;
        if (currentCapital < 0) currentCapital = 0;
        data.push({
          period: i,
          capital: currentCapital - gain,
          gain: gain,
          total: currentCapital
        });
      }
      
      const finalCapital = currentCapital;
      const totalProfit = finalCapital - capital - (deposit * periods) + (withdraw * periods);
      const percentGain = capital > 0 ? ((finalCapital - capital) / capital * 100) : 0;
      
      // Actualizar resultados
      document.getElementById('compoundInitialOut').textContent = '$' + capital.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
      document.getElementById('compoundFinalOut').textContent = '$' + finalCapital.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
      document.getElementById('compoundProfitOut').textContent = '$' + totalProfit.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
      document.getElementById('compoundPercentOut').textContent = percentGain.toFixed(2) + '%';
      
      // Actualizar tabla
      const tbody = document.getElementById('compoundTableBody');
      tbody.innerHTML = data.map((row, index) => `
        <tr class="${index % 2 === 0 ? 'bg-white' : 'bg-neutral-50'}">
          <td class="px-3 py-2 font-medium text-neutral-600">${row.period}</td>
          <td class="px-3 py-2 text-right mono text-neutral-700">$${(row.total - row.gain).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
          <td class="px-3 py-2 text-right mono text-green-600">+$${row.gain.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
          <td class="px-3 py-2 text-right mono font-semibold text-brand">$${row.total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
        </tr>
      `).join('');
      
      // Actualizar gr√°fico
      updateCompoundChart(data);
    }

    function updateCompoundChart(data) {
      const canvas = document.getElementById('compoundChart');
      const ctx = canvas.getContext('2d');
      
      // Ajustar tama√±o del canvas
      const container = canvas.parentElement;
      canvas.width = container.offsetWidth;
      canvas.height = container.offsetHeight;
      
      const width = canvas.width;
      const height = canvas.height;
      const padding = { top: 20, right: 20, bottom: 30, left: 60 };
      const chartWidth = width - padding.left - padding.right;
      const chartHeight = height - padding.top - padding.bottom;
      
      // Limpiar canvas
      ctx.clearRect(0, 0, width, height);
      
      if (data.length < 2) return;
      
      const maxValue = Math.max(...data.map(d => d.total));
      const minValue = Math.min(...data.map(d => d.total));
      const valueRange = maxValue - minValue || 1;
      
      // Dibujar grid
      ctx.strokeStyle = '#e5e7eb';
      ctx.lineWidth = 1;
      for (let i = 0; i <= 5; i++) {
        const y = padding.top + (chartHeight / 5) * i;
        ctx.beginPath();
        ctx.moveTo(padding.left, y);
        ctx.lineTo(width - padding.right, y);
        ctx.stroke();
        
        // Labels del eje Y
        const value = maxValue - (valueRange / 5) * i;
        ctx.fillStyle = '#6b7280';
        ctx.font = '11px Outfit';
        ctx.textAlign = 'right';
        ctx.fillText('$' + value.toLocaleString('en-US', {maximumFractionDigits: 0}), padding.left - 8, y + 4);
      }
      
      // Dibujar √°rea bajo la curva
      ctx.beginPath();
      ctx.moveTo(padding.left, padding.top + chartHeight);
      
      data.forEach((point, index) => {
        const x = padding.left + (index / (data.length - 1)) * chartWidth;
        const y = padding.top + chartHeight - ((point.total - minValue) / valueRange) * chartHeight;
        ctx.lineTo(x, y);
      });
      
      ctx.lineTo(padding.left + chartWidth, padding.top + chartHeight);
      ctx.closePath();
      
      const gradient = ctx.createLinearGradient(0, padding.top, 0, height - padding.bottom);
      gradient.addColorStop(0, 'rgba(34, 197, 94, 0.3)');
      gradient.addColorStop(1, 'rgba(34, 197, 94, 0.05)');
      ctx.fillStyle = gradient;
      ctx.fill();
      
      // Dibujar l√≠nea
      ctx.beginPath();
      data.forEach((point, index) => {
        const x = padding.left + (index / (data.length - 1)) * chartWidth;
        const y = padding.top + chartHeight - ((point.total - minValue) / valueRange) * chartHeight;
        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });
      ctx.strokeStyle = '#22c55e';
      ctx.lineWidth = 3;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.stroke();
      
      // Dibujar puntos
      data.forEach((point, index) => {
        const x = padding.left + (index / (data.length - 1)) * chartWidth;
        const y = padding.top + chartHeight - ((point.total - minValue) / valueRange) * chartHeight;
        
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fillStyle = '#22c55e';
        ctx.fill();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.stroke();
      });
      
      // Labels del eje X
      ctx.fillStyle = '#6b7280';
      ctx.font = '11px Outfit';
      ctx.textAlign = 'center';
      const xLabels = Math.min(data.length, 10);
      for (let i = 0; i < xLabels; i++) {
        const index = Math.floor((i / (xLabels - 1)) * (data.length - 1));
        const x = padding.left + (index / (data.length - 1)) * chartWidth;
        ctx.fillText(data[index].period.toString(), x, height - 8);
      }
    }

    // Event listeners para inter√©s compuesto
    document.getElementById('btnCompoundCalc').addEventListener('click', calculateCompound);
    document.getElementById('compoundPeriod').addEventListener('change', updatePeriodHelp);
    document.getElementById('compoundPeriods').addEventListener('input', updatePeriodHelp);
    
    // Calcular al escribir en cualquier campo
    ['compoundCapital', 'compoundGain', 'compoundPeriods', 'compoundDeposit', 'compoundWithdraw'].forEach(id => {
      document.getElementById(id).addEventListener('input', calculateCompound);
    });
    document.getElementById('compoundPeriod').addEventListener('change', calculateCompound);
    
    // Calcular inicialmente
    updatePeriodHelp();
    calculateCompound();
  </script>
</body>
</html>
