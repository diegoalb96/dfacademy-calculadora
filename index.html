<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>DF ACADEMY ¬∑ Calculadora de Tama√±o de Posici√≥n</title>
  <meta name="description" content="Calculadora de tama√±o de posici√≥n para trading de Forex, XAUUSD y Petr√≥leo por DF ACADEMY." />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#040D51" />
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="DF Calc" />
  <link rel="icon" type="image/png" href="assets/icon-192.png" />

  <!-- Tailwind CDN -->
  <script>
    tailwind = { config: { theme: { extend: {
      colors: { brand: '#040D51', accent: '#F7BE0C' }
    }}}}
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body{background:#fafafa}
  </style>
</head>
<body class="text-neutral-900">
  <!-- Header -->
  <header class="sticky top-0 z-[40] shadow-sm" style="background:#040D51;">
    <div class="max-w-6xl mx-auto px-4 h-14 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="assets/logo.png" alt="DF Academy" class="h-8 w-auto" />
        <span class="text-white/90 text-sm">Herramientas de Trading</span>
      </div>
    </div>
  </header>

  <!-- Ticker Tape (visible tambi√©n en m√≥vil) -->
  <div id="tv-tape" style="background:#040D51; border-bottom:1px solid #0b1355;">
    <div class="tradingview-widget-container" style="max-width:100%; margin:0 auto;">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript"
        src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      {
        "symbols": [
          { "proName": "FX:EURUSD",           "title": "EUR/USD" },
          { "proName": "OANDA:XAUUSD",        "title": "XAU/USD" },
          { "proName": "FX:GBPUSD",           "title": "GBP/USD" },
          { "proName": "FX:USDJPY",           "title": "USD/JPY" },
          { "proName": "CAPITALCOM:US500",    "title": "S&P 500" },
          { "proName": "BINANCE:BTCUSDT",     "title": "BTC/USDT" }
        ],
        "showSymbolLogo": true,
        "isTransparent": true,
        "displayMode": "adaptive",
        "colorTheme": "dark",
        "locale": "es"
      }
      </script>
    </div>
  </div>

  <!-- Main -->
  <main id="calc" class="min-h-screen w-full">
    <section class="max-w-6xl mx-auto px-4 py-8">
      <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight">
        <span class="text-brand">DF ACADEMY</span> ¬∑ Calculadora de Tama√±o de Posici√≥n
      </h1>
      <p class="mt-2 text-neutral-600">
        Calcula tama√±o de posici√≥n, riesgo monetario y valor por pip. Soporta <b>Forex</b>, <b>XAUUSD</b>, <b>XAGUSD</b>, <b>USOIL</b> y <b>UKOIL</b>.
      </p>

      <div class="grid md:grid-cols-2 gap-6 mt-8">
        <!-- Par√°metros -->
        <div class="bg-white shadow-sm border rounded-xl p-5">
          <div class="flex items-center gap-2 mb-4">
            <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-accent/20 text-brand font-bold">‚öôÔ∏è</span>
            <h2 class="text-lg font-semibold">Par√°metros</h2>
          </div>

          <!-- S√≠mbolo -->
          <label class="block text-sm font-medium">Par</label>
          <select id="symbol" class="mt-1 w-full rounded-lg border px-3 py-2">
            <!-- FX mayores -->
            <option value="EURUSD">EURUSD</option>
            <option value="GBPUSD">GBPUSD</option>
            <option value="AUDUSD">AUDUSD</option>
            <option value="NZDUSD">NZDUSD</option>
            <option value="USDCAD">USDCAD</option>
            <option value="USDCHF">USDCHF</option>
            <option value="USDJPY">USDJPY</option>
            <option value="EURJPY">EURJPY</option>
            <option value="GBPJPY">GBPJPY</option>
            <!-- Metales -->
            <option value="XAUUSD">XAUUSD (Oro)</option>
            <option value="XAGUSD">XAGUSD (Plata)</option>
            <!-- Energ√≠a -->
            <option value="USOIL">USOIL (WTI)</option>
            <option value="UKOIL">UKOIL (Brent)</option>
          </select>
          <p id="pairMeta" class="mt-1 text-xs text-neutral-500"></p>

          <!-- Divisa cuenta -->
          <div class="grid grid-cols-2 gap-3 mt-4">
            <div>
              <label class="block text-sm font-medium">Divisa de la cuenta</label>
              <select id="accountCcy" class="mt-1 w-full rounded-lg border px-3 py-2">
                <option>USD</option>
                <option>EUR</option>
                <option>JPY</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium">Tama√±o de la cuenta</label>
              <input id="balance" type="number" step="0.01" value="1000" class="mt-1 w-full rounded-lg border px-3 py-2" />
            </div>
          </div>

          <!-- Riesgo & Stop -->
          <div class="grid grid-cols-2 gap-3 mt-4">
            <div>
              <label class="block text-sm font-medium">Riesgo (%)</label>
              <input id="riskPct" type="number" step="0.01" value="1" class="mt-1 w-full rounded-lg border px-3 py-2" />
            </div>
            <div>
              <label class="block text-sm font-medium">Stop Loss (pips)</label>
              <input id="stopPips" type="number" step="0.01" value="20" class="mt-1 w-full rounded-lg border px-3 py-2" />
            </div>
          </div>

          <!-- Precio & Conversi√≥n -->
          <div class="grid grid-cols-2 gap-3 mt-4">
            <div>
              <label class="block text-sm font-medium">Precio actual (referencia)</label>
              <input id="price" type="number" step="0.0001" value="1.1000" class="mt-1 w-full rounded-lg border px-3 py-2" />
              <p class="text-[11px] text-neutral-500 mt-1">Informativo; el tama√±o de pip es est√°ndar por par.</p>
            </div>
            <div>
              <label class="block text-sm font-medium">TC cotizada ‚Üí divisa de la cuenta</label>
              <input id="conv" type="number" step="0.0001" value="1.0000" class="mt-1 w-full rounded-lg border px-3 py-2" />
              <p class="text-[11px] text-neutral-500 mt-1">
                Si la <b>divisa de la cuenta</b> ‚â† <b>cotizada</b>, coloca el tipo de cambio (ej: USD/JPY si tu cuenta es USD y la cotizada es JPY). Si coinciden, d√©jalo en 1.0000.
              </p>
            </div>
          </div>

          <div class="flex items-center gap-3 mt-5">
            <button id="btnCalc" class="px-4 py-2 rounded-lg text-white" style="background:#040D51;">Calcular</button>
            <button id="btnReset" class="px-4 py-2 rounded-lg border">Reiniciar</button>
          </div>

          <div class="mt-5 bg-accent/10 border border-accent/30 rounded-lg p-3 text-sm">
            <p class="font-medium">F√≥rmula:</p>
            <p class="text-neutral-700">
              <b>Unidades</b> = (Balance √ó Riesgo%) / (Stop(pips) √ó <i>valor de pip por unidad</i> en la divisa de tu cuenta).
              <br/>Para FX: 1 pip por unidad = pipSize en cotizada (0.0001; JPY = 0.01). Para commodities: 1 pip por unidad f√≠sica (onza/barril) = 0.01 en cotizada.
            </p>
          </div>
        </div>

        <!-- Resultados -->
        <div class="bg-white shadow-sm border rounded-xl p-5">
          <div class="flex items-center gap-2 mb-4">
            <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-accent/20 text-brand font-bold">üìä</span>
            <h2 class="text-lg font-semibold">Resultados</h2>
          </div>

          <div class="grid sm:grid-cols-2 gap-4">
            <div class="rounded-lg border p-4">
              <p class="text-sm text-neutral-500">Riesgo monetario</p>
              <p id="riskMoneyOut" class="text-2xl font-semibold mt-1">‚Äî</p>
            </div>

            <div class="rounded-lg border p-4">
              <p class="text-sm text-neutral-500">Valor por pip (por unidad)</p>
              <p id="pipValueOut" class="text-2xl font-semibold mt-1">‚Äî</p>
            </div>

            <div class="rounded-lg border p-4">
              <p class="text-sm text-neutral-500">Unidades (<span id="unitLabel">base</span>)</p>
              <p id="unitsOut" class="text-2xl font-semibold mt-1">‚Äî</p>
            </div>

            <div class="rounded-lg border p-4">
              <p class="text-sm text-neutral-500">Lotes <span id="lotsLabel">(100k)</span></p>
              <p id="lotsOut" class="text-2xl font-semibold mt-1">‚Äî</p>
            </div>

            <div class="rounded-lg border p-4">
              <p class="text-sm text-neutral-500">Mini lotes (0.1)</p>
              <p id="miniOut" class="text-2xl font-semibold mt-1">‚Äî</p>
            </div>

            <div class="rounded-lg border p-4">
              <p class="text-sm text-neutral-500">Micro lotes (0.01)</p>
              <p id="microOut" class="text-2xl font-semibold mt-1">‚Äî</p>
            </div>
          </div>

          <div id="instrumentTip" class="mt-4 text-sm text-neutral-600"></div>

          <div class="mt-6 text-sm text-neutral-600">
            <h3 class="font-semibold mb-2">Notas r√°pidas</h3>
            <ul class="list-disc pl-5 space-y-1">
              <li>Para JPY, el pip est√°ndar es 0.01.</li>
              <li>Si la divisa de la cuenta ‚â† cotizada, usa el tipo de cambio cotizada‚Üícuenta.</li>
              <li>FX: 1 lote = 100,000 unidades; XAUUSD: 1 lote = 100 onzas; XAGUSD: 1 lote = 5,000 onzas; USOIL/UKOIL: 1 lote = 100 barriles.</li>
              <li>No incluye comisiones, spreads ni deslizamiento.</li>
            </ul>
          </div>
        </div>
      </div>

      <p class="text-center text-xs text-neutral-500 mt-8">¬© 2025 DF ACADEMY ¬∑ Herramienta educativa.</p>
    </section>
  </main>

  <!-- L√≥gica de c√°lculo -->
  <script>
    // --- Instrumentos soportados ---
    const INSTRUMENTS = {
      // Plantillas
      _fx:     { type:'fx', lotSize:100000, pipSize:0.0001, unitLabel:'unidades' },
      _fxJPY:  { type:'fx', lotSize:100000, pipSize:0.01,   unitLabel:'unidades' },

      // Metales
      XAUUSD: { type:'commodity', base:'XAU', quote:'USD', pipSize:0.01, lotSize:100,  unitLabel:'onzas',
                note:'XAUUSD: 1 pip = 0.01 USD por onza; 1 lote = 100 onzas.' },
      XAGUSD: { type:'commodity', base:'XAG', quote:'USD', pipSize:0.01, lotSize:5000, unitLabel:'onzas',
                note:'XAGUSD: 1 pip = 0.01 USD por onza; 1 lote = 5,000 onzas.' },

      // Energ√≠a (ajustable seg√∫n broker)
      USOIL:  { type:'commodity', base:'OIL', quote:'USD', pipSize:0.01, lotSize:100,  unitLabel:'barriles',
                note:'USOIL: 1 pip = 0.01 USD por barril; 1 lote = 100 barriles.' },
      UKOIL:  { type:'commodity', base:'OIL', quote:'USD', pipSize:0.01, lotSize:100,  unitLabel:'barriles',
                note:'UKOIL: 1 pip = 0.01 USD por barril; 1 lote = 100 barriles.' }
    };

    function resolveInstrument(symbol){
      if(INSTRUMENTS[symbol]) return INSTRUMENTS[symbol];
      const base = symbol.slice(0,3), quote = symbol.slice(3,6);
      const isJPY = quote === 'JPY' || symbol.endsWith('JPY');
      const tpl = isJPY ? INSTRUMENTS._fxJPY : INSTRUMENTS._fx;
      return { ...tpl, base, quote };
    }

    // Valor de pip por UNIDAD (en divisa de la cuenta)
    function pipValuePerUnit(instr, convRate=1){
      return instr.pipSize * (Number(convRate)||1);
    }

    function fmt(n, d=2){ if(!isFinite(n)) return '‚Äî'; return Number(n).toLocaleString(undefined,{minimumFractionDigits:d, maximumFractionDigits:d}); }

    function recalc(){
      const symbol = document.getElementById('symbol').value;
      const accountCcy = document.getElementById('accountCcy').value.toUpperCase();
      const balance = Number(document.getElementById('balance').value);
      const riskPct = Number(document.getElementById('riskPct').value);
      const stopPips = Number(document.getElementById('stopPips').value);
      const price = Number(document.getElementById('price').value); // informativo
      const convInput = Number(document.getElementById('conv').value);

      const instr = resolveInstrument(symbol);
      const quote = instr.quote || symbol.slice(3,6);

      // Si cuenta==cotizada ‚áí conv=1; si no, usar input
      const conv = (accountCcy === (quote||'').toUpperCase()) ? 1 : (convInput || 1);

      const riskMoney = balance * (riskPct/100);
      const pipPerUnit = pipValuePerUnit(instr, conv);
      const units = riskMoney / (stopPips * pipPerUnit);

      const lotSize = instr.lotSize ?? 100000;
      const lots = units / lotSize;
      const miniLots = units / (lotSize/10);
      const microLots = units / (lotSize/100);

      // Etiquetas din√°micas
      document.getElementById('unitLabel').textContent = instr.unitLabel || 'unidades';
      document.getElementById('lotsLabel').textContent = `(${lotSize.toLocaleString()} ${instr.unitLabel||'unidades'})`;

      // Pintar resultados
      document.getElementById('riskMoneyOut').textContent = `${fmt(riskMoney,2)} ${accountCcy}`;
      document.getElementById('pipValueOut').textContent = `${fmt(pipPerUnit, instr.pipSize===0.01?4:6)} ${accountCcy} / ${instr.unitLabel||'unidad'}`;
      document.getElementById('unitsOut').textContent = fmt(units,0);
      document.getElementById('lotsOut').textContent = fmt(lots,2);
      document.getElementById('miniOut').textContent = fmt(miniLots,1);
      document.getElementById('microOut').textContent = fmt(microLots,0);

      // Meta y tips
      const base = instr.base || symbol.slice(0,3);
      const cot = quote;
      document.getElementById('pairMeta').textContent = `Base: ${base} ¬∑ Cotizada: ${cot} ¬∑ Pip: ${instr.pipSize}`;
      document.getElementById('instrumentTip').textContent = instr.note || '';
    }

    function resetForm(){
      document.getElementById('symbol').value = 'EURUSD';
      document.getElementById('accountCcy').value = 'USD';
      document.getElementById('balance').value = 1000;
      document.getElementById('riskPct').value = 1;
      document.getElementById('stopPips').value = 20;
      document.getElementById('price').value = 1.1000;
      document.getElementById('conv').value = 1.0000;
      recalc();
    }

    // Eventos
    ['symbol','accountCcy','balance','riskPct','stopPips','price','conv'].forEach(id=>{
      document.getElementById(id).addEventListener('input', recalc);
      document.getElementById(id).addEventListener('change', recalc);
    });
    document.getElementById('btnCalc').addEventListener('click', recalc);
    document.getElementById('btnReset').addEventListener('click', resetForm);

    // Init
    recalc();
  </script>

  <!-- Service Worker (si ya lo tienes en tu proyecto) -->
  <script>
    if('serviceWorker' in navigator){
      // registra s√≥lo si ya tienes service-worker.js en la ra√≠z
      navigator.serviceWorker.register('/service-worker.js').catch(()=>{});
    }
  </script>
</body>
</html>
