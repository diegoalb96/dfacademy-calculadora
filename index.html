<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>DF ACADEMY ¬∑ Calculadora de Tama√±o de Posici√≥n</title>
  <meta name="description" content="Calculadora de tama√±o de posici√≥n para trading de Forex, Metales, √çndices, Criptomonedas y Commodities por DF ACADEMY." />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#040D51" />
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="DF Calc" />
  <link rel="icon" type="image/png" href="assets/icon-192.png" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script>
    tailwind = { config: { theme: { extend: {
      colors: { brand: '#040D51', accent: '#F7BE0C', brandLight: '#0b1355' },
      fontFamily: { sans: ['DM Sans', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }
    }}}}
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); font-family: 'DM Sans', sans-serif; }
    .result-card { transition: all 0.2s ease; }
    .result-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px -5px rgba(4, 13, 81, 0.1); }
    select, input { font-family: 'DM Sans', sans-serif; }
    .mono { font-family: 'JetBrains Mono', monospace; }
    .category-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .cat-forex { background: #dbeafe; color: #1e40af; }
    .cat-metals { background: #fef3c7; color: #92400e; }
    .cat-energy { background: #fee2e2; color: #991b1b; }
    .cat-indices { background: #d1fae5; color: #065f46; }
    .cat-crypto { background: #ede9fe; color: #5b21b6; }
    optgroup { font-weight: 700; color: #040D51; background: #f8fafc; }
    option { font-weight: 400; color: #1f2937; padding: 8px; }
    .gradient-border { background: linear-gradient(135deg, #040D51, #F7BE0C); padding: 1px; border-radius: 12px; }
    .gradient-border > div { background: white; border-radius: 11px; }
  </style>
</head>
<body class="text-neutral-900 min-h-screen">
  <!-- Header -->
  <header class="sticky top-0 z-[40] shadow-lg" style="background: linear-gradient(90deg, #040D51 0%, #0b1355 100%);">
    <div class="max-w-6xl mx-auto px-4 h-14 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="assets/logo.png" alt="DF Academy" class="h-8 w-auto" onerror="this.style.display='none'" />
        <span class="text-white/90 text-sm font-medium">Herramientas de Trading</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="hidden sm:inline-block text-xs text-white/60 bg-white/10 px-2 py-1 rounded">v2.0</span>
      </div>
    </div>
  </header>

  <!-- Ticker Tape -->
  <div id="tv-tape" style="background:#040D51; border-bottom:1px solid #0b1355;">
    <div class="tradingview-widget-container" style="max-width:100%; margin:0 auto;">
      <div class="tradingview-widget-container__widget"></div>
      <script type="text/javascript"
        src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      {
        "symbols": [
          { "proName": "FX:EURUSD",           "title": "EUR/USD" },
          { "proName": "OANDA:XAUUSD",        "title": "XAU/USD" },
          { "proName": "FX:GBPUSD",           "title": "GBP/USD" },
          { "proName": "FX:USDJPY",           "title": "USD/JPY" },
          { "proName": "CAPITALCOM:US500",    "title": "S&P 500" },
          { "proName": "CAPITALCOM:US100",    "title": "NASDAQ" },
          { "proName": "BINANCE:BTCUSDT",     "title": "BTC/USDT" },
          { "proName": "BINANCE:ETHUSDT",     "title": "ETH/USDT" }
        ],
        "showSymbolLogo": true,
        "isTransparent": true,
        "displayMode": "adaptive",
        "colorTheme": "dark",
        "locale": "es"
      }
      </script>
    </div>
  </div>

  <!-- Main -->
  <main id="calc" class="min-h-screen w-full">
    <section class="max-w-6xl mx-auto px-4 py-8">
      <div class="text-center mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold tracking-tight">
          <span style="color: #040D51;">DF ACADEMY</span> <span class="text-neutral-400">¬∑</span> Calculadora de Posici√≥n
        </h1>
        <p class="mt-3 text-neutral-600 max-w-2xl mx-auto">
          Calcula el tama√±o √≥ptimo de tu posici√≥n basado en tu gesti√≥n de riesgo. Soporta <b>Forex</b>, <b>Metales</b>, <b>Energ√≠as</b>, <b>√çndices</b> y <b>Criptomonedas</b>.
        </p>
        
        <!-- Categor√≠as badge -->
        <div class="flex flex-wrap justify-center gap-2 mt-4">
          <span class="category-badge cat-forex">Forex</span>
          <span class="category-badge cat-metals">Metales</span>
          <span class="category-badge cat-energy">Energ√≠a</span>
          <span class="category-badge cat-indices">√çndices</span>
          <span class="category-badge cat-crypto">Cripto</span>
        </div>
      </div>

      <div class="grid lg:grid-cols-2 gap-6">
        <!-- Par√°metros -->
        <div class="gradient-border">
          <div class="bg-white shadow-sm rounded-xl p-6">
            <div class="flex items-center gap-2 mb-5">
              <span class="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-brand text-white font-bold text-lg">‚öôÔ∏è</span>
              <div>
                <h2 class="text-lg font-bold text-brand">Par√°metros</h2>
                <p class="text-xs text-neutral-500">Configura tu operaci√≥n</p>
              </div>
            </div>

            <!-- S√≠mbolo -->
            <label class="block text-sm font-semibold text-neutral-700">Instrumento</label>
            <select id="symbol" class="mt-1 w-full rounded-lg border-2 border-neutral-200 px-3 py-2.5 focus:border-brand focus:outline-none transition-colors">
              
              <!-- FOREX MAYORES -->
              <optgroup label="üìà FOREX - Mayores">
                <option value="EURUSD">EUR/USD (Euro / D√≥lar)</option>
                <option value="GBPUSD">GBP/USD (Libra / D√≥lar)</option>
                <option value="USDJPY">USD/JPY (D√≥lar / Yen)</option>
                <option value="USDCHF">USD/CHF (D√≥lar / Franco Suizo)</option>
                <option value="AUDUSD">AUD/USD (Aussie / D√≥lar)</option>
                <option value="USDCAD">USD/CAD (D√≥lar / CAD)</option>
                <option value="NZDUSD">NZD/USD (Kiwi / D√≥lar)</option>
              </optgroup>
              
              <!-- FOREX MENORES / CRUCES -->
              <optgroup label="üìä FOREX - Cruces">
                <option value="EURGBP">EUR/GBP</option>
                <option value="EURJPY">EUR/JPY</option>
                <option value="EURCHF">EUR/CHF</option>
                <option value="EURAUD">EUR/AUD</option>
                <option value="EURCAD">EUR/CAD</option>
                <option value="EURNZD">EUR/NZD</option>
                <option value="GBPJPY">GBP/JPY</option>
                <option value="GBPCHF">GBP/CHF</option>
                <option value="GBPAUD">GBP/AUD</option>
                <option value="GBPCAD">GBP/CAD</option>
                <option value="GBPNZD">GBP/NZD</option>
                <option value="AUDJPY">AUD/JPY</option>
                <option value="AUDCHF">AUD/CHF</option>
                <option value="AUDCAD">AUD/CAD</option>
                <option value="AUDNZD">AUD/NZD</option>
                <option value="CADJPY">CAD/JPY</option>
                <option value="CADCHF">CAD/CHF</option>
                <option value="CHFJPY">CHF/JPY</option>
                <option value="NZDJPY">NZD/JPY</option>
                <option value="NZDCHF">NZD/CHF</option>
                <option value="NZDCAD">NZD/CAD</option>
              </optgroup>
              
              <!-- FOREX EX√ìTICOS -->
              <optgroup label="üåç FOREX - Ex√≥ticos">
                <option value="USDMXN">USD/MXN (D√≥lar / Peso Mexicano)</option>
                <option value="USDZAR">USD/ZAR (D√≥lar / Rand Sudafricano)</option>
                <option value="USDTRY">USD/TRY (D√≥lar / Lira Turca)</option>
                <option value="USDSEK">USD/SEK (D√≥lar / Corona Sueca)</option>
                <option value="USDNOK">USD/NOK (D√≥lar / Corona Noruega)</option>
                <option value="USDDKK">USD/DKK (D√≥lar / Corona Danesa)</option>
                <option value="USDSGD">USD/SGD (D√≥lar / D√≥lar Singapur)</option>
                <option value="USDHKD">USD/HKD (D√≥lar / D√≥lar Hong Kong)</option>
                <option value="USDPLN">USD/PLN (D√≥lar / Zloty Polaco)</option>
                <option value="USDHUF">USD/HUF (D√≥lar / Flor√≠n H√∫ngaro)</option>
                <option value="USDCZK">USD/CZK (D√≥lar / Corona Checa)</option>
                <option value="USDTHB">USD/THB (D√≥lar / Baht Tailand√©s)</option>
                <option value="USDCNH">USD/CNH (D√≥lar / Yuan Offshore)</option>
                <option value="USDINR">USD/INR (D√≥lar / Rupia India)</option>
                <option value="EURTRY">EUR/TRY (Euro / Lira Turca)</option>
                <option value="EURMXN">EUR/MXN (Euro / Peso Mexicano)</option>
                <option value="EURZAR">EUR/ZAR (Euro / Rand)</option>
                <option value="EURSEK">EUR/SEK (Euro / Corona Sueca)</option>
                <option value="EURNOK">EUR/NOK (Euro / Corona Noruega)</option>
                <option value="EURPLN">EUR/PLN (Euro / Zloty)</option>
                <option value="EURHUF">EUR/HUF (Euro / Flor√≠n)</option>
                <option value="GBPZAR">GBP/ZAR (Libra / Rand)</option>
                <option value="GBPTRY">GBP/TRY (Libra / Lira)</option>
                <option value="GBPSEK">GBP/SEK (Libra / Corona Sueca)</option>
                <option value="GBPNOK">GBP/NOK (Libra / Corona Noruega)</option>
              </optgroup>
              
              <!-- METALES -->
              <optgroup label="ü•á METALES">
                <option value="XAUUSD">XAU/USD (Oro)</option>
                <option value="XAGUSD">XAG/USD (Plata)</option>
                <option value="XPTUSD">XPT/USD (Platino)</option>
                <option value="XPDUSD">XPD/USD (Paladio)</option>
                <option value="XAUEUR">XAU/EUR (Oro / Euro)</option>
                <option value="XAGEUR">XAG/EUR (Plata / Euro)</option>
                <option value="XAUCNH">XAU/CNH (Oro / Yuan)</option>
              </optgroup>
              
              <!-- ENERG√çAS -->
              <optgroup label="‚õΩ ENERG√çAS">
                <option value="USOIL">USOIL / WTI (Petr√≥leo Crudo)</option>
                <option value="UKOIL">UKOIL / Brent (Petr√≥leo Brent)</option>
                <option value="NGAS">NGAS (Gas Natural)</option>
              </optgroup>
              
              <!-- √çNDICES -->
              <optgroup label="üìâ √çNDICES - USA">
                <option value="US30">US30 / Dow Jones</option>
                <option value="US500">US500 / S&P 500</option>
                <option value="US100">US100 / NASDAQ 100</option>
                <option value="US2000">US2000 / Russell 2000</option>
              </optgroup>
              
              <optgroup label="üìâ √çNDICES - Europa">
                <option value="GER40">GER40 / DAX (Alemania)</option>
                <option value="UK100">UK100 / FTSE 100 (Reino Unido)</option>
                <option value="FRA40">FRA40 / CAC 40 (Francia)</option>
                <option value="ESP35">ESP35 / IBEX 35 (Espa√±a)</option>
                <option value="EU50">EU50 / Euro Stoxx 50</option>
                <option value="SUI20">SUI20 / SMI (Suiza)</option>
                <option value="NED25">NED25 / AEX (Holanda)</option>
              </optgroup>
              
              <optgroup label="üìâ √çNDICES - Asia/Ocean√≠a">
                <option value="JPN225">JPN225 / Nikkei 225 (Jap√≥n)</option>
                <option value="HK50">HK50 / Hang Seng (Hong Kong)</option>
                <option value="AUS200">AUS200 / ASX 200 (Australia)</option>
                <option value="CHN50">CHN50 / China A50</option>
                <option value="SGP20">SGP20 / STI (Singapur)</option>
              </optgroup>
              
              <!-- CRIPTOMONEDAS -->
              <optgroup label="‚Çø CRIPTOMONEDAS">
                <option value="BTCUSD">BTC/USD (Bitcoin)</option>
                <option value="ETHUSD">ETH/USD (Ethereum)</option>
                <option value="LTCUSD">LTC/USD (Litecoin)</option>
                <option value="XRPUSD">XRP/USD (Ripple)</option>
                <option value="BCHUSD">BCH/USD (Bitcoin Cash)</option>
                <option value="ADAUSD">ADA/USD (Cardano)</option>
                <option value="DOTUSD">DOT/USD (Polkadot)</option>
                <option value="SOLUSD">SOL/USD (Solana)</option>
                <option value="DOGEUSD">DOGE/USD (Dogecoin)</option>
                <option value="LINKUSD">LINK/USD (Chainlink)</option>
                <option value="AVAXUSD">AVAX/USD (Avalanche)</option>
                <option value="MATICUSD">MATIC/USD (Polygon)</option>
              </optgroup>
              
            </select>
            <p id="pairMeta" class="mt-1.5 text-xs text-neutral-500"></p>

            <!-- Divisa cuenta & Balance -->
            <div class="grid grid-cols-2 gap-4 mt-5">
              <div>
                <label class="block text-sm font-semibold text-neutral-700">Divisa de la cuenta</label>
                <select id="accountCcy" class="mt-1 w-full rounded-lg border-2 border-neutral-200 px-3 py-2.5 focus:border-brand focus:outline-none transition-colors">
                  <option>USD</option>
                  <option>EUR</option>
                  <option>GBP</option>
                  <option>JPY</option>
                  <option>CHF</option>
                  <option>AUD</option>
                  <option>CAD</option>
                  <option>NZD</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-semibold text-neutral-700">Balance de la cuenta</label>
                <input id="balance" type="number" step="0.01" value="10000" class="mt-1 w-full rounded-lg border-2 border-neutral-200 px-3 py-2.5 focus:border-brand focus:outline-none transition-colors" />
              </div>
            </div>

            <!-- Riesgo & Stop -->
            <div class="grid grid-cols-2 gap-4 mt-4">
              <div>
                <label class="block text-sm font-semibold text-neutral-700">Riesgo (%)</label>
                <input id="riskPct" type="number" step="0.01" value="1" class="mt-1 w-full rounded-lg border-2 border-neutral-200 px-3 py-2.5 focus:border-brand focus:outline-none transition-colors" />
              </div>
              <div>
                <label class="block text-sm font-semibold text-neutral-700">Stop Loss (pips/puntos)</label>
                <input id="stopPips" type="number" step="0.1" value="20" class="mt-1 w-full rounded-lg border-2 border-neutral-200 px-3 py-2.5 focus:border-brand focus:outline-none transition-colors" />
              </div>
            </div>

            <!-- Precio & Conversi√≥n -->
            <div class="grid grid-cols-2 gap-4 mt-4">
              <div>
                <label class="block text-sm font-semibold text-neutral-700">Precio actual</label>
                <input id="price" type="number" step="0.00001" value="1.10000" class="mt-1 w-full rounded-lg border-2 border-neutral-200 px-3 py-2.5 focus:border-brand focus:outline-none transition-colors mono text-sm" />
                <p class="text-[11px] text-neutral-500 mt-1">Precio de referencia del instrumento</p>
              </div>
              <div>
                <label class="block text-sm font-semibold text-neutral-700">TC ‚Üí Cuenta</label>
                <input id="conv" type="number" step="0.0001" value="1.0000" class="mt-1 w-full rounded-lg border-2 border-neutral-200 px-3 py-2.5 focus:border-brand focus:outline-none transition-colors mono text-sm" />
                <p class="text-[11px] text-neutral-500 mt-1">Tipo de cambio cotizada ‚Üí divisa cuenta</p>
              </div>
            </div>

            <div class="flex items-center gap-3 mt-6">
              <button id="btnCalc" class="flex-1 px-5 py-3 rounded-lg text-white font-semibold transition-all hover:opacity-90 active:scale-[0.98]" style="background: linear-gradient(135deg, #040D51, #0b1355);">
                üìä Calcular
              </button>
              <button id="btnReset" class="px-5 py-3 rounded-lg border-2 border-neutral-300 font-semibold text-neutral-600 hover:bg-neutral-50 transition-all active:scale-[0.98]">
                ‚Ü∫ Reset
              </button>
            </div>
          </div>
        </div>

        <!-- Resultados -->
        <div class="bg-white shadow-sm border rounded-xl p-6">
          <div class="flex items-center gap-2 mb-5">
            <span class="inline-flex h-10 w-10 items-center justify-center rounded-xl bg-accent text-brand font-bold text-lg">üìä</span>
            <div>
              <h2 class="text-lg font-bold text-brand">Resultados</h2>
              <p class="text-xs text-neutral-500">Tu tama√±o de posici√≥n √≥ptimo</p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div class="result-card rounded-xl border-2 border-red-100 bg-red-50/50 p-4">
              <p class="text-sm text-red-600 font-medium">üí∞ Riesgo Monetario</p>
              <p id="riskMoneyOut" class="text-2xl font-bold mt-1 mono text-red-700">‚Äî</p>
            </div>

            <div class="result-card rounded-xl border-2 border-blue-100 bg-blue-50/50 p-4">
              <p class="text-sm text-blue-600 font-medium">üìè Valor por Pip</p>
              <p id="pipValueOut" class="text-xl font-bold mt-1 mono text-blue-700">‚Äî</p>
            </div>

            <div class="result-card rounded-xl border-2 border-brand/20 bg-brand/5 p-4">
              <p class="text-sm text-brand font-medium">üì¶ <span id="unitLabel">Unidades</span></p>
              <p id="unitsOut" class="text-2xl font-bold mt-1 mono text-brand">‚Äî</p>
            </div>

            <div class="result-card rounded-xl border-2 border-accent/40 bg-accent/10 p-4">
              <p class="text-sm text-amber-700 font-medium">üéØ Lotes <span id="lotsLabel">(100k)</span></p>
              <p id="lotsOut" class="text-2xl font-bold mt-1 mono text-amber-700">‚Äî</p>
            </div>

            <div class="result-card rounded-xl border-2 border-green-100 bg-green-50/50 p-4">
              <p class="text-sm text-green-600 font-medium">Mini Lotes (0.1)</p>
              <p id="miniOut" class="text-xl font-bold mt-1 mono text-green-700">‚Äî</p>
            </div>

            <div class="result-card rounded-xl border-2 border-purple-100 bg-purple-50/50 p-4">
              <p class="text-sm text-purple-600 font-medium">Micro Lotes (0.01)</p>
              <p id="microOut" class="text-xl font-bold mt-1 mono text-purple-700">‚Äî</p>
            </div>
          </div>

          <div id="instrumentTip" class="mt-4 p-3 rounded-lg bg-neutral-100 text-sm text-neutral-700"></div>

          <div class="mt-6 p-4 rounded-xl bg-gradient-to-br from-brand/5 to-accent/5 border border-brand/10">
            <h3 class="font-bold text-brand mb-2">üìö Notas del Instrumento</h3>
            <ul id="instrumentNotes" class="text-sm text-neutral-600 space-y-1">
              <li>Selecciona un instrumento para ver informaci√≥n espec√≠fica.</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Tabla de referencia -->
      <div class="mt-8 bg-white rounded-xl shadow-sm border p-6">
        <h3 class="text-lg font-bold text-brand mb-4">üìã Referencia R√°pida de Tama√±os de Lote</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="bg-brand/5">
                <th class="text-left p-3 font-semibold">Categor√≠a</th>
                <th class="text-left p-3 font-semibold">1 Lote Est√°ndar</th>
                <th class="text-left p-3 font-semibold">1 Pip</th>
                <th class="text-left p-3 font-semibold">Valor t√≠pico por pip (1 lote)</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-neutral-100">
              <tr>
                <td class="p-3"><span class="category-badge cat-forex">Forex</span></td>
                <td class="p-3 mono">100,000 unidades</td>
                <td class="p-3 mono">0.0001 (JPY: 0.01)</td>
                <td class="p-3 mono">~$10 USD</td>
              </tr>
              <tr>
                <td class="p-3"><span class="category-badge cat-metals">Oro (XAU)</span></td>
                <td class="p-3 mono">100 onzas</td>
                <td class="p-3 mono">0.01 ($0.01)</td>
                <td class="p-3 mono">$1 USD</td>
              </tr>
              <tr>
                <td class="p-3"><span class="category-badge cat-metals">Plata (XAG)</span></td>
                <td class="p-3 mono">5,000 onzas</td>
                <td class="p-3 mono">0.01 ($0.01)</td>
                <td class="p-3 mono">$50 USD</td>
              </tr>
              <tr>
                <td class="p-3"><span class="category-badge cat-energy">Petr√≥leo</span></td>
                <td class="p-3 mono">100-1,000 barriles*</td>
                <td class="p-3 mono">0.01 ($0.01)</td>
                <td class="p-3 mono">$1-$10 USD*</td>
              </tr>
              <tr>
                <td class="p-3"><span class="category-badge cat-indices">√çndices</span></td>
                <td class="p-3 mono">Var√≠a por broker</td>
                <td class="p-3 mono">1.0 (1 punto)</td>
                <td class="p-3 mono">$1-$10 USD*</td>
              </tr>
              <tr>
                <td class="p-3"><span class="category-badge cat-crypto">Cripto</span></td>
                <td class="p-3 mono">1 unidad (BTC, ETH...)</td>
                <td class="p-3 mono">1.0 ($1)</td>
                <td class="p-3 mono">$1 USD</td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="text-xs text-neutral-500 mt-3">* Var√≠a seg√∫n el broker. Consulta las especificaciones de tu broker para valores exactos.</p>
      </div>

      <p class="text-center text-xs text-neutral-500 mt-8">¬© 2025 DF ACADEMY ¬∑ Herramienta educativa. No constituye asesor√≠a financiera.</p>
    </section>
  </main>

  <!-- L√≥gica de c√°lculo -->
  <script>
    // ===============================================
    // BASE DE DATOS DE INSTRUMENTOS
    // ===============================================
    const INSTRUMENTS = {
      // -------- PLANTILLAS --------
      _fx:     { type:'forex', lotSize:100000, pipSize:0.0001, unitLabel:'unidades', category:'forex' },
      _fxJPY:  { type:'forex', lotSize:100000, pipSize:0.01,   unitLabel:'unidades', category:'forex' },

      // -------- METALES --------
      XAUUSD: { type:'metal', base:'XAU', quote:'USD', pipSize:0.01, lotSize:100, unitLabel:'onzas', category:'metals',
                note:'Oro: 1 pip = $0.01 por onza. 1 lote est√°ndar = 100 onzas. Valor por pip (1 lote) = $1 USD.' },
      XAGUSD: { type:'metal', base:'XAG', quote:'USD', pipSize:0.01, lotSize:5000, unitLabel:'onzas', category:'metals',
                note:'Plata: 1 pip = $0.01 por onza. 1 lote est√°ndar = 5,000 onzas. Valor por pip (1 lote) = $50 USD.' },
      XPTUSD: { type:'metal', base:'XPT', quote:'USD', pipSize:0.01, lotSize:100, unitLabel:'onzas', category:'metals',
                note:'Platino: 1 pip = $0.01 por onza. 1 lote = 100 onzas.' },
      XPDUSD: { type:'metal', base:'XPD', quote:'USD', pipSize:0.01, lotSize:100, unitLabel:'onzas', category:'metals',
                note:'Paladio: 1 pip = $0.01 por onza. 1 lote = 100 onzas.' },
      XAUEUR: { type:'metal', base:'XAU', quote:'EUR', pipSize:0.01, lotSize:100, unitLabel:'onzas', category:'metals',
                note:'Oro/Euro: 1 pip = ‚Ç¨0.01 por onza. Ajusta TC si tu cuenta no es EUR.' },
      XAGEUR: { type:'metal', base:'XAG', quote:'EUR', pipSize:0.01, lotSize:5000, unitLabel:'onzas', category:'metals',
                note:'Plata/Euro: 1 pip = ‚Ç¨0.01 por onza. 1 lote = 5,000 onzas.' },
      XAUCNH: { type:'metal', base:'XAU', quote:'CNH', pipSize:0.01, lotSize:100, unitLabel:'onzas', category:'metals',
                note:'Oro/Yuan: Ajusta el TC a tu divisa de cuenta.' },

      // -------- ENERG√çAS --------
      USOIL:  { type:'energy', base:'OIL', quote:'USD', pipSize:0.01, lotSize:100, unitLabel:'barriles', category:'energy',
                note:'WTI Crudo: 1 pip = $0.01 por barril. 1 lote t√≠pico = 100 barriles (var√≠a por broker).' },
      UKOIL:  { type:'energy', base:'OIL', quote:'USD', pipSize:0.01, lotSize:100, unitLabel:'barriles', category:'energy',
                note:'Brent Crudo: 1 pip = $0.01 por barril. 1 lote t√≠pico = 100 barriles.' },
      NGAS:   { type:'energy', base:'GAS', quote:'USD', pipSize:0.001, lotSize:10000, unitLabel:'MMBtu', category:'energy',
                note:'Gas Natural: Especificaciones var√≠an por broker. Verifica tu plataforma.' },

      // -------- √çNDICES USA --------
      US30:   { type:'index', base:'US30', quote:'USD', pipSize:1.0, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'Dow Jones: 1 punto = $1 por contrato (t√≠pico). Verifica con tu broker.' },
      US500:  { type:'index', base:'US500', quote:'USD', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'S&P 500: 1 tick = $0.10 t√≠pico. Especificaciones var√≠an por broker.' },
      US100:  { type:'index', base:'US100', quote:'USD', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'NASDAQ 100: 1 tick = $0.10-$1.00 seg√∫n broker.' },
      US2000: { type:'index', base:'US2000', quote:'USD', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'Russell 2000: Verifica especificaciones con tu broker.' },

      // -------- √çNDICES EUROPA --------
      GER40:  { type:'index', base:'GER40', quote:'EUR', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'DAX Alem√°n: Cotizado en EUR. Ajusta TC si tu cuenta no es EUR.' },
      UK100:  { type:'index', base:'UK100', quote:'GBP', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'FTSE 100: Cotizado en GBP. Ajusta TC si tu cuenta no es GBP.' },
      FRA40:  { type:'index', base:'FRA40', quote:'EUR', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'CAC 40 Franc√©s: Cotizado en EUR.' },
      ESP35:  { type:'index', base:'ESP35', quote:'EUR', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'IBEX 35 Espa√±ol: Cotizado en EUR.' },
      EU50:   { type:'index', base:'EU50', quote:'EUR', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'Euro Stoxx 50: Cotizado en EUR.' },
      SUI20:  { type:'index', base:'SUI20', quote:'CHF', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'SMI Suizo: Cotizado en CHF.' },
      NED25:  { type:'index', base:'NED25', quote:'EUR', pipSize:0.01, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'AEX Holand√©s: Cotizado en EUR.' },

      // -------- √çNDICES ASIA --------
      JPN225: { type:'index', base:'JPN225', quote:'JPY', pipSize:1.0, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'Nikkei 225: Cotizado en JPY. Ajusta TC.' },
      HK50:   { type:'index', base:'HK50', quote:'HKD', pipSize:1.0, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'Hang Seng: Cotizado en HKD. Ajusta TC.' },
      AUS200: { type:'index', base:'AUS200', quote:'AUD', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'ASX 200: Cotizado en AUD.' },
      CHN50:  { type:'index', base:'CHN50', quote:'USD', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'China A50: T√≠picamente cotizado en USD.' },
      SGP20:  { type:'index', base:'SGP20', quote:'SGD', pipSize:0.1, lotSize:1, unitLabel:'contratos', category:'indices',
                note:'STI Singapur: Cotizado en SGD.' },

      // -------- CRIPTOMONEDAS --------
      BTCUSD: { type:'crypto', base:'BTC', quote:'USD', pipSize:1.0, lotSize:1, unitLabel:'BTC', category:'crypto',
                note:'Bitcoin: 1 pip = $1. 1 lote = 1 BTC. Alta volatilidad.' },
      ETHUSD: { type:'crypto', base:'ETH', quote:'USD', pipSize:0.1, lotSize:1, unitLabel:'ETH', category:'crypto',
                note:'Ethereum: 1 pip = $0.10. 1 lote = 1 ETH.' },
      LTCUSD: { type:'crypto', base:'LTC', quote:'USD', pipSize:0.01, lotSize:1, unitLabel:'LTC', category:'crypto',
                note:'Litecoin: 1 lote = 1 LTC.' },
      XRPUSD: { type:'crypto', base:'XRP', quote:'USD', pipSize:0.0001, lotSize:1000, unitLabel:'XRP', category:'crypto',
                note:'Ripple: 1 lote t√≠pico = 1,000 XRP (var√≠a por broker).' },
      BCHUSD: { type:'crypto', base:'BCH', quote:'USD', pipSize:0.01, lotSize:1, unitLabel:'BCH', category:'crypto',
                note:'Bitcoin Cash: 1 lote = 1 BCH.' },
      ADAUSD: { type:'crypto', base:'ADA', quote:'USD', pipSize:0.0001, lotSize:1000, unitLabel:'ADA', category:'crypto',
                note:'Cardano: 1 lote t√≠pico = 1,000 ADA.' },
      DOTUSD: { type:'crypto', base:'DOT', quote:'USD', pipSize:0.001, lotSize:100, unitLabel:'DOT', category:'crypto',
                note:'Polkadot: Especificaciones var√≠an por broker.' },
      SOLUSD: { type:'crypto', base:'SOL', quote:'USD', pipSize:0.01, lotSize:10, unitLabel:'SOL', category:'crypto',
                note:'Solana: 1 lote t√≠pico = 10 SOL.' },
      DOGEUSD: { type:'crypto', base:'DOGE', quote:'USD', pipSize:0.00001, lotSize:10000, unitLabel:'DOGE', category:'crypto',
                note:'Dogecoin: 1 lote t√≠pico = 10,000 DOGE.' },
      LINKUSD: { type:'crypto', base:'LINK', quote:'USD', pipSize:0.001, lotSize:100, unitLabel:'LINK', category:'crypto',
                note:'Chainlink: Especificaciones var√≠an por broker.' },
      AVAXUSD: { type:'crypto', base:'AVAX', quote:'USD', pipSize:0.01, lotSize:10, unitLabel:'AVAX', category:'crypto',
                note:'Avalanche: Especificaciones var√≠an por broker.' },
      MATICUSD: { type:'crypto', base:'MATIC', quote:'USD', pipSize:0.0001, lotSize:1000, unitLabel:'MATIC', category:'crypto',
                note:'Polygon: 1 lote t√≠pico = 1,000 MATIC.' }
    };

    // Pares Forex expl√≠citos (para precios default)
    const FX_PAIRS = {
      // Mayores
      EURUSD: { base:'EUR', quote:'USD', defaultPrice: 1.10000 },
      GBPUSD: { base:'GBP', quote:'USD', defaultPrice: 1.27000 },
      USDJPY: { base:'USD', quote:'JPY', defaultPrice: 149.000 },
      USDCHF: { base:'USD', quote:'CHF', defaultPrice: 0.88000 },
      AUDUSD: { base:'AUD', quote:'USD', defaultPrice: 0.66000 },
      USDCAD: { base:'USD', quote:'CAD', defaultPrice: 1.36000 },
      NZDUSD: { base:'NZD', quote:'USD', defaultPrice: 0.61000 },
      // Cruces
      EURGBP: { base:'EUR', quote:'GBP', defaultPrice: 0.86500 },
      EURJPY: { base:'EUR', quote:'JPY', defaultPrice: 164.000 },
      EURCHF: { base:'EUR', quote:'CHF', defaultPrice: 0.97000 },
      EURAUD: { base:'EUR', quote:'AUD', defaultPrice: 1.67000 },
      EURCAD: { base:'EUR', quote:'CAD', defaultPrice: 1.50000 },
      EURNZD: { base:'EUR', quote:'NZD', defaultPrice: 1.81000 },
      GBPJPY: { base:'GBP', quote:'JPY', defaultPrice: 189.000 },
      GBPCHF: { base:'GBP', quote:'CHF', defaultPrice: 1.12000 },
      GBPAUD: { base:'GBP', quote:'AUD', defaultPrice: 1.93000 },
      GBPCAD: { base:'GBP', quote:'CAD', defaultPrice: 1.73000 },
      GBPNZD: { base:'GBP', quote:'NZD', defaultPrice: 2.10000 },
      AUDJPY: { base:'AUD', quote:'JPY', defaultPrice: 98.000 },
      AUDCHF: { base:'AUD', quote:'CHF', defaultPrice: 0.58000 },
      AUDCAD: { base:'AUD', quote:'CAD', defaultPrice: 0.90000 },
      AUDNZD: { base:'AUD', quote:'NZD', defaultPrice: 1.09000 },
      CADJPY: { base:'CAD', quote:'JPY', defaultPrice: 110.000 },
      CADCHF: { base:'CAD', quote:'CHF', defaultPrice: 0.65000 },
      CHFJPY: { base:'CHF', quote:'JPY', defaultPrice: 169.000 },
      NZDJPY: { base:'NZD', quote:'JPY', defaultPrice: 90.000 },
      NZDCHF: { base:'NZD', quote:'CHF', defaultPrice: 0.54000 },
      NZDCAD: { base:'NZD', quote:'CAD', defaultPrice: 0.83000 },
      // Ex√≥ticos
      USDMXN: { base:'USD', quote:'MXN', defaultPrice: 17.50000 },
      USDZAR: { base:'USD', quote:'ZAR', defaultPrice: 18.50000 },
      USDTRY: { base:'USD', quote:'TRY', defaultPrice: 32.00000 },
      USDSEK: { base:'USD', quote:'SEK', defaultPrice: 10.50000 },
      USDNOK: { base:'USD', quote:'NOK', defaultPrice: 10.80000 },
      USDDKK: { base:'USD', quote:'DKK', defaultPrice: 6.90000 },
      USDSGD: { base:'USD', quote:'SGD', defaultPrice: 1.35000 },
      USDHKD: { base:'USD', quote:'HKD', defaultPrice: 7.82000 },
      USDPLN: { base:'USD', quote:'PLN', defaultPrice: 4.00000 },
      USDHUF: { base:'USD', quote:'HUF', defaultPrice: 360.000 },
      USDCZK: { base:'USD', quote:'CZK', defaultPrice: 23.00000 },
      USDTHB: { base:'USD', quote:'THB', defaultPrice: 35.00000 },
      USDCNH: { base:'USD', quote:'CNH', defaultPrice: 7.25000 },
      USDINR: { base:'USD', quote:'INR', defaultPrice: 83.00000 },
      EURTRY: { base:'EUR', quote:'TRY', defaultPrice: 35.00000 },
      EURMXN: { base:'EUR', quote:'MXN', defaultPrice: 19.20000 },
      EURZAR: { base:'EUR', quote:'ZAR', defaultPrice: 20.30000 },
      EURSEK: { base:'EUR', quote:'SEK', defaultPrice: 11.50000 },
      EURNOK: { base:'EUR', quote:'NOK', defaultPrice: 11.80000 },
      EURPLN: { base:'EUR', quote:'PLN', defaultPrice: 4.40000 },
      EURHUF: { base:'EUR', quote:'HUF', defaultPrice: 395.000 },
      GBPZAR: { base:'GBP', quote:'ZAR', defaultPrice: 23.50000 },
      GBPTRY: { base:'GBP', quote:'TRY', defaultPrice: 40.50000 },
      GBPSEK: { base:'GBP', quote:'SEK', defaultPrice: 13.30000 },
      GBPNOK: { base:'GBP', quote:'NOK', defaultPrice: 13.70000 }
    };

    // ===============================================
    // FUNCIONES DE RESOLUCI√ìN
    // ===============================================
    function resolveInstrument(symbol) {
      // Si est√° definido expl√≠citamente
      if (INSTRUMENTS[symbol]) {
        const instr = { ...INSTRUMENTS[symbol] };
        // Para metales/commodities/indices/crypto, ya tienen base/quote
        if (!instr.base) {
          const fxData = FX_PAIRS[symbol];
          if (fxData) {
            instr.base = fxData.base;
            instr.quote = fxData.quote;
          }
        }
        return instr;
      }
      
      // Si es un par FX no definido en INSTRUMENTS pero s√≠ en FX_PAIRS
      if (FX_PAIRS[symbol]) {
        const fxData = FX_PAIRS[symbol];
        const isJPY = fxData.quote === 'JPY' || fxData.quote === 'HUF';
        const tpl = isJPY ? INSTRUMENTS._fxJPY : INSTRUMENTS._fx;
        return { ...tpl, base: fxData.base, quote: fxData.quote, defaultPrice: fxData.defaultPrice };
      }
      
      // Fallback: intentar deducir de los 6 caracteres
      const base = symbol.slice(0, 3);
      const quote = symbol.slice(3, 6);
      const isJPY = quote === 'JPY' || symbol.endsWith('JPY');
      const tpl = isJPY ? INSTRUMENTS._fxJPY : INSTRUMENTS._fx;
      return { ...tpl, base, quote };
    }

    function getDefaultPrice(symbol) {
      if (FX_PAIRS[symbol]) return FX_PAIRS[symbol].defaultPrice;
      const instr = INSTRUMENTS[symbol];
      if (instr) {
        // Precios default aproximados por tipo
        if (instr.type === 'metal') {
          if (symbol.includes('XAU')) return 2650.00;
          if (symbol.includes('XAG')) return 31.50;
          if (symbol.includes('XPT')) return 980.00;
          if (symbol.includes('XPD')) return 950.00;
        }
        if (instr.type === 'energy') {
          if (symbol.includes('OIL')) return 75.00;
          if (symbol === 'NGAS') return 2.50;
        }
        if (instr.type === 'index') {
          const indexPrices = {
            US30: 42500, US500: 5900, US100: 21000, US2000: 2200,
            GER40: 20500, UK100: 8200, FRA40: 7500, ESP35: 11800, EU50: 5000,
            SUI20: 12000, NED25: 900, JPN225: 39000, HK50: 20000, AUS200: 8300,
            CHN50: 12500, SGP20: 3400
          };
          return indexPrices[symbol] || 10000;
        }
        if (instr.type === 'crypto') {
          const cryptoPrices = {
            BTCUSD: 98000, ETHUSD: 3500, LTCUSD: 105, XRPUSD: 2.30,
            BCHUSD: 450, ADAUSD: 0.95, DOTUSD: 7.50, SOLUSD: 195,
            DOGEUSD: 0.32, LINKUSD: 23, AVAXUSD: 40, MATICUSD: 0.50
          };
          return cryptoPrices[symbol] || 100;
        }
      }
      return 1.10000;
    }

    // Valor de pip por UNIDAD (en divisa de la cuenta)
    function pipValuePerUnit(instr, convRate = 1) {
      return instr.pipSize * (Number(convRate) || 1);
    }

    function fmt(n, d = 2) {
      if (!isFinite(n)) return '‚Äî';
      return Number(n).toLocaleString(undefined, { minimumFractionDigits: d, maximumFractionDigits: d });
    }

    // ===============================================
    // C√ÅLCULO PRINCIPAL
    // ===============================================
    function recalc() {
      const symbol = document.getElementById('symbol').value;
      const accountCcy = document.getElementById('accountCcy').value.toUpperCase();
      const balance = Number(document.getElementById('balance').value);
      const riskPct = Number(document.getElementById('riskPct').value);
      const stopPips = Number(document.getElementById('stopPips').value);
      const convInput = Number(document.getElementById('conv').value);

      const instr = resolveInstrument(symbol);
      const quote = instr.quote || symbol.slice(3, 6);

      // Si cuenta==cotizada ‚áí conv=1; si no, usar input
      const conv = (accountCcy === (quote || '').toUpperCase()) ? 1 : (convInput || 1);

      const riskMoney = balance * (riskPct / 100);
      const pipPerUnit = pipValuePerUnit(instr, conv);
      const units = riskMoney / (stopPips * pipPerUnit);

      const lotSize = instr.lotSize ?? 100000;
      const lots = units / lotSize;
      const miniLots = units / (lotSize / 10);
      const microLots = units / (lotSize / 100);

      // Etiquetas din√°micas
      document.getElementById('unitLabel').textContent = instr.unitLabel || 'Unidades';
      document.getElementById('lotsLabel').textContent = `(${lotSize.toLocaleString()} ${instr.unitLabel || 'unidades'})`;

      // Pintar resultados
      document.getElementById('riskMoneyOut').textContent = `${fmt(riskMoney, 2)} ${accountCcy}`;
      document.getElementById('pipValueOut').textContent = `${fmt(pipPerUnit, instr.pipSize >= 0.1 ? 4 : 6)} ${accountCcy}`;
      document.getElementById('unitsOut').textContent = fmt(units, instr.type === 'crypto' ? 4 : 0);
      document.getElementById('lotsOut').textContent = fmt(lots, 2);
      document.getElementById('miniOut').textContent = fmt(miniLots, 2);
      document.getElementById('microOut').textContent = fmt(microLots, 1);

      // Meta info
      const base = instr.base || symbol.slice(0, 3);
      document.getElementById('pairMeta').innerHTML = `
        <span class="inline-block px-2 py-0.5 bg-brand/10 text-brand rounded text-xs font-medium mr-2">${base}/${quote}</span>
        <span class="text-neutral-400">Pip: ${instr.pipSize}</span>
        <span class="text-neutral-400 mx-2">‚Ä¢</span>
        <span class="text-neutral-400">Lote: ${lotSize.toLocaleString()} ${instr.unitLabel || 'unidades'}</span>
      `;

      // Notas del instrumento
      const notesEl = document.getElementById('instrumentNotes');
      const tipEl = document.getElementById('instrumentTip');
      
      if (instr.note) {
        tipEl.innerHTML = `<strong>‚ÑπÔ∏è Info:</strong> ${instr.note}`;
        tipEl.style.display = 'block';
      } else {
        tipEl.style.display = 'none';
      }

      // Notas generales por tipo
      let notes = [];
      if (instr.type === 'forex' || instr.category === 'forex') {
        notes = [
          `Par Forex: ${base}/${quote}`,
          `1 pip = ${instr.pipSize} en la divisa cotizada (${quote})`,
          `1 lote est√°ndar = 100,000 ${base}`,
          accountCcy !== quote ? `‚ö†Ô∏è Tu cuenta es ${accountCcy}, ajusta el TC (${quote}/${accountCcy})` : `‚úì Tu cuenta coincide con la cotizada (${accountCcy})`
        ];
      } else if (instr.type === 'metal') {
        notes = [
          `Metal precioso: ${base}`,
          `Cotizado en ${quote}`,
          `1 lote = ${lotSize.toLocaleString()} ${instr.unitLabel}`,
          accountCcy !== quote ? `‚ö†Ô∏è Ajusta el TC ${quote}‚Üí${accountCcy}` : `‚úì Cuenta en ${accountCcy}`
        ];
      } else if (instr.type === 'energy') {
        notes = [
          `Energ√≠a: ${symbol}`,
          `1 lote t√≠pico = ${lotSize} ${instr.unitLabel}`,
          `‚ö†Ô∏è Verifica especificaciones con tu broker`
        ];
      } else if (instr.type === 'index') {
        notes = [
          `√çndice: ${symbol}`,
          `Cotizado en ${quote}`,
          `‚ö†Ô∏è Tama√±o de contrato var√≠a por broker`,
          `Verifica el valor por punto en tu plataforma`
        ];
      } else if (instr.type === 'crypto') {
        notes = [
          `Criptomoneda: ${base}`,
          `1 lote = ${lotSize} ${base}`,
          `‚ö†Ô∏è Alta volatilidad - gestiona tu riesgo`,
          `Especificaciones var√≠an por broker/exchange`
        ];
      }

      notesEl.innerHTML = notes.map(n => `<li>${n}</li>`).join('');
    }

    function resetForm() {
      document.getElementById('symbol').value = 'EURUSD';
      document.getElementById('accountCcy').value = 'USD';
      document.getElementById('balance').value = 10000;
      document.getElementById('riskPct').value = 1;
      document.getElementById('stopPips').value = 20;
      document.getElementById('price').value = 1.10000;
      document.getElementById('conv').value = 1.0000;
      recalc();
    }

    // Actualizar precio default cuando cambia el s√≠mbolo
    function updateDefaultPrice() {
      const symbol = document.getElementById('symbol').value;
      const defaultPrice = getDefaultPrice(symbol);
      document.getElementById('price').value = defaultPrice;
    }

    // ===============================================
    // EVENTOS
    // ===============================================
    document.getElementById('symbol').addEventListener('change', () => {
      updateDefaultPrice();
      recalc();
    });

    ['accountCcy', 'balance', 'riskPct', 'stopPips', 'price', 'conv'].forEach(id => {
      document.getElementById(id).addEventListener('input', recalc);
      document.getElementById(id).addEventListener('change', recalc);
    });

    document.getElementById('btnCalc').addEventListener('click', recalc);
    document.getElementById('btnReset').addEventListener('click', resetForm);

    // ===============================================
    // INIT
    // ===============================================
    recalc();
  </script>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js').catch(() => {});
    }
  </script>
</body>
</html>
