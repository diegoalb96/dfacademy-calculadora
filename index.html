<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DF ACADEMY ¬∑ Calculadora de Tama√±o de Posici√≥n</title>
  <meta name="description" content="Calculadora de tama√±o de posici√≥n para trading de Forex y XAUUSD por DF ACADEMY" />
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Suave mejora visual */
    body { background: #fafafa; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const PAIRS = [
      { label: "EURUSD", base: "EUR", quote: "USD", pipSize: 0.0001 },
      { label: "GBPUSD", base: "GBP", quote: "USD", pipSize: 0.0001 },
      { label: "AUDUSD", base: "AUD", quote: "USD", pipSize: 0.0001 },
      { label: "NZDUSD", base: "NZD", quote: "USD", pipSize: 0.0001 },
      { label: "USDCHF", base: "USD", quote: "CHF", pipSize: 0.0001 },
      { label: "USDCAD", base: "USD", quote: "CAD", pipSize: 0.0001 },
      { label: "USDJPY", base: "USD", quote: "JPY", pipSize: 0.01 },
      { label: "EURJPY", base: "EUR", quote: "JPY", pipSize: 0.01 },
      { label: "GBPJPY", base: "GBP", quote: "JPY", pipSize: 0.01 },
      { label: "XAUUSD (Oro)", base: "XAU", quote: "USD", pipSize: 0.1 },
    ];
    const CURRENCIES = ["USD","EUR","JPY","CHF","CAD","AUD","NZD"];

    const toNumber = (v) => {
      const n = Number(String(v).replace(/,/g, "."));
      return isFinite(n) ? n : 0;
    };
    const format = (n, digits = 2) =>
      !isFinite(n) ? "-" : new Intl.NumberFormat(undefined, { maximumFractionDigits: digits }).format(n);

    function Metric({ label, value }) {
      return (
        <div className="rounded-2xl border p-4 bg-neutral-50">
          <div className="text-xs text-neutral-500 mb-1">{label}</div>
          <div className="text-2xl font-semibold">{value}</div>
        </div>
      );
    }

    function App() {
      const [pairIdx, setPairIdx] = React.useState(0);
      const pair = PAIRS[pairIdx];

      const [accountCurrency, setAccountCurrency] = React.useState("USD");
      const [balance, setBalance] = React.useState("1000");
      const [riskPct, setRiskPct] = React.useState("1");
      const [stopPips, setStopPips] = React.useState("20");
      const [price, setPrice] = React.useState("1.1000");
      const [convQuoteToAccount, setConvQuoteToAccount] = React.useState("1");

      const quoteEqAccount = pair.quote === accountCurrency;

      const pipValuePerUnitInAccount = React.useMemo(() => {
        const pip = pair.pipSize;
        const conv = quoteEqAccount ? 1 : (toNumber(convQuoteToAccount) || 0);
        return pip * conv;
      }, [pair, convQuoteToAccount, quoteEqAccount]);

      const riskMoney = React.useMemo(() => (toNumber(balance) * toNumber(riskPct)) / 100, [balance, riskPct]);

      const requiredUnits = React.useMemo(() => {
        const pips = toNumber(stopPips);
        const pv = pipValuePerUnitInAccount;
        if (pips <= 0 || pv <= 0) return 0;
        return riskMoney / (pips * pv);
      }, [riskMoney, stopPips, pipValuePerUnitInAccount]);

      const lots = requiredUnits / 100000;
      const miniLots = requiredUnits / 10000;
      const microLots = requiredUnits / 1000;
      const moneyPerPip = pipValuePerUnitInAccount * requiredUnits;
      const needsConversionRate = !quoteEqAccount;

      const reset = () => {
        setPairIdx(0);
        setAccountCurrency("USD");
        setBalance("1000");
        setRiskPct("1");
        setStopPips("20");
        setPrice("1.1000");
        setConvQuoteToAccount("1");
      };

      return (
        <div className="min-h-screen w-full bg-neutral-50 text-neutral-900">
          <div className="max-w-5xl mx-auto px-4 py-8">
            <header className="mb-6 flex flex-col gap-2">
              <h1 className="text-3xl sm:text-4xl font-bold tracking-tight">DF ACADEMY ¬∑ Calculadora de Tama√±o de Posici√≥n</h1>
              <p className="text-neutral-600">Calcula tama√±o de posici√≥n, riesgo monetario y valor por pip. Soporta Forex y XAUUSD.</p>
            </header>

            <div className="grid md:grid-cols-2 gap-6">
              <section className="bg-white rounded-2xl shadow p-5 border">
                <h2 className="text-lg font-semibold mb-4 flex items-center gap-2">‚öôÔ∏è Par√°metros</h2>

                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm mb-1">Par</label>
                    <select className="w-full rounded-xl border px-3 py-2" value={pairIdx} onChange={(e)=>setPairIdx(Number(e.target.value))}>
                      {PAIRS.map((p,i)=>(<option key={p.label} value={i}>{p.label}</option>))}
                    </select>
                    <p className="text-xs text-neutral-500 mt-1">Base: {pair.base} ¬∑ Cotizada: {pair.quote} ¬∑ Pip: {pair.pipSize}</p>
                  </div>

                  <div>
                    <label className="block text-sm mb-1">Divisa de la cuenta</label>
                    <select className="w-full rounded-xl border px-3 py-2" value={accountCurrency} onChange={(e)=>setAccountCurrency(e.target.value)}>
                      {CURRENCIES.map((c)=>(<option key={c} value={c}>{c}</option>))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm mb-1">Tama√±o de la cuenta ({accountCurrency})</label>
                    <input className="w-full rounded-xl border px-3 py-2" inputMode="decimal" value={balance} onChange={(e)=>setBalance(e.target.value)} />
                  </div>

                  <div>
                    <label className="block text-sm mb-1">Riesgo (%)</label>
                    <input className="w-full rounded-xl border px-3 py-2" inputMode="decimal" value={riskPct} onChange={(e)=>setRiskPct(e.target.value)} />
                  </div>

                  <div>
                    <label className="block text-sm mb-1">Stop Loss (pips)</label>
                    <input className="w-full rounded-xl border px-3 py-2" inputMode="decimal" value={stopPips} onChange={(e)=>setStopPips(e.target.value)} />
                  </div>

                  <div>
                    <label className="block text-sm mb-1">Precio actual (referencia)</label>
                    <input className="w-full rounded-xl border px-3 py-2" inputMode="decimal" value={price} onChange={(e)=>setPrice(e.target.value)} />
                    <p className="text-xs text-neutral-500 mt-1">Informativo; el tama√±o de pip es est√°ndar por par.</p>
                  </div>

                  {needsConversionRate && (
                    <div className="sm:col-span-2">
                      <label className="block text-sm mb-1">Tipo de cambio {pair.quote} ‚Üí {accountCurrency}</label>
                      <input className="w-full rounded-xl border px-3 py-2" inputMode="decimal" value={convQuoteToAccount} onChange={(e)=>setConvQuoteToAccount(e.target.value)} />
                      <p className="text-xs text-neutral-500 mt-1">Ej.: si tu cuenta est√° en USD y el par cotiza en JPY, usa JPY‚ÜíUSD (‚âà 1 / USDJPY).</p>
                    </div>
                  )}
                </div>

                <div className="mt-4 flex items-center gap-3">
                  <button onClick={reset} className="px-4 py-2 rounded-xl bg-neutral-100 hover:bg-neutral-200 inline-flex items-center gap-2">üîÑ Reiniciar</button>
                </div>

                <div className="mt-6 bg-neutral-50 rounded-xl border p-4 flex items-start gap-2">
                  <div className="mt-0.5">‚ÑπÔ∏è</div>
                  <p className="text-sm text-neutral-700">
                    F√≥rmula: <span className="font-semibold">Unidades = (Balance √ó Riesgo%) / (Stop(pips) √ó Valor de pip por unidad)</span>.
                    El valor de pip por unidad (en la divisa de la cuenta) es <span className="font-mono">pipSize √ó (tipo de cambio cotizada‚Üícuenta)</span>.
                  </p>
                </div>
              </section>

              <section className="bg-white rounded-2xl shadow p-5 border">
                <h2 className="text-lg font-semibold mb-4">Resultados</h2>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <Metric label={\`Riesgo monetario (\${accountCurrency})\`} value={format(riskMoney, 2)} />
                  <Metric label={\`Valor por pip (\${accountCurrency})\`} value={format(moneyPerPip, 4)} />
                  <Metric label="Unidades (base)" value={format(requiredUnits, 2)} />
                  <Metric label="Lotes (100k)" value={format(lots, 3)} />
                  <Metric label="Mini lotes (10k)" value={format(miniLots, 3)} />
                  <Metric label="Micro lotes (1k)" value={format(microLots, 3)} />
                </div>

                {requiredUnits <= 0 && (
                  <div className="mt-6 bg-amber-50 text-amber-900 rounded-xl border border-amber-200 p-4 flex gap-2">
                    <div className="mt-0.5">‚ö†Ô∏è</div>
                    <p className="text-sm">Completa los campos con valores v√°lidos. El stop en pips y el tipo de cambio (cuando aplica) deben ser mayores a 0.</p>
                  </div>
                )}

                <div className="mt-6">
                  <h3 className="font-semibold mb-2">Notas r√°pidas</h3>
                  <ul className="list-disc ml-5 text-sm text-neutral-700 space-y-1">
                    <li>Para JPY, el pip est√°ndar es 0.01; para la mayor√≠a de pares, 0.0001.</li>
                    <li>Si la divisa de la cuenta ‚â† divisa cotizada, usa el tipo de cambio <span className="font-mono">cotizada‚Üícuenta</span>.</li>
                    <li>1 lote = 100,000 unidades; 1 mini lote = 10,000; 1 micro lote = 1,000.</li>
                    <li>No incluye comisiones, spreads ni deslizamiento.</li>
                  </ul>
                </div>
              </section>
            </div>

            <footer className="mt-8 text-center text-xs text-neutral-500">
              ¬© {new Date().getFullYear()} DF ACADEMY ¬∑ Herramienta educativa.
            </footer>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
